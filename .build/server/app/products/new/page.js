(()=>{var e={};e.id=2187,e.ids=[2187],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25743:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>i}),t(71617),t(32694),t(71363);var s=t(36576),a=t(72007),o=t(21818),l=t.n(o),n=t(88897),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(r,d);let i=["",{children:["products",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,71617)),"/home/ubuntu/supermarket_pos_system/nextjs_space/app/products/new/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,32694)),"/home/ubuntu/supermarket_pos_system/nextjs_space/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,71363,23)),"next/dist/client/components/not-found-error"]}],c=["/home/ubuntu/supermarket_pos_system/nextjs_space/app/products/new/page.tsx"],u="/products/new/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/products/new/page",pathname:"/products/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:i}})},80471:(e,r,t)=>{Promise.resolve().then(t.bind(t,290))},290:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>j});var s=t(62901),a=t(73735),o=t(12458),l=t(92861),n=t(24383),d=t(84374),i=t(75909),c=t(10780),u=t(20134),m=t(68734),p=t(91464),g=t(10333),x=t(62392),h=t(39350),b=t(52875),f=t(74190),y=t(59617);function j(){let e=(0,d.useRouter)(),{currency:r}=(0,f.U8)(),{selectedStore:t}=(0,y.o)(),[j,v]=(0,n.useState)([]),[w,N]=(0,n.useState)([]),[k,P]=(0,n.useState)(!1),[_,C]=(0,n.useState)(!1),S=(0,n.useRef)(null),[A,F]=(0,n.useState)({barcode:"",name:"",description:"",price:"",stock:"",reorderLevel:"10",categoryId:"",supplierId:"",imageUrl:"",cloud_storage_path:"",isPublic:!0}),E=async e=>{let r=e.target.files?.[0];if(r)try{C(!0);let e=await fetch("/api/products/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:r.name,contentType:r.type,isPublic:!0})});if(!e.ok)throw Error("Failed to get upload URL");let{uploadUrl:t,cloud_storage_path:s}=await e.json(),a=new URL(t).searchParams.get("X-Amz-SignedHeaders"),o=a?.includes?.("content-disposition"),l={"Content-Type":r.type};if(o&&(l["Content-Disposition"]="attachment"),!(await fetch(t,{method:"PUT",headers:l,body:r})).ok)throw Error("Failed to upload file");let n=await fetch(`/api/products/upload?cloud_storage_path=${encodeURIComponent(s)}&isPublic=true`),d=(await n.json()).url;F(e=>({...e,imageUrl:d,cloud_storage_path:s})),h.Am.success("Image uploaded successfully")}catch(e){console.error("Error uploading image:",e),h.Am.error("Failed to upload image")}finally{C(!1)}},I=async r=>{if(r.preventDefault(),!t){h.Am.error("Please select a store first");return}P(!0);try{let r=await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...A,storeId:t.id})});if(r.ok)h.Am.success("Product created successfully"),e.push("/products");else{let e=await r.json();h.Am.error(e?.error||"Failed to create product")}}catch(e){console.error("Error creating product:",e),h.Am.error("Error creating product")}finally{P(!1)}};return s.jsx(a.I,{children:(0,s.jsxs)(o.p,{allowedRoles:["ADMIN"],children:[s.jsx(h.x7,{position:"top-right"}),(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(l.W,{}),(0,s.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8",children:[s.jsx("div",{className:"mb-6",children:(0,s.jsxs)(x.default,{href:"/products",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[s.jsx(i.Z,{className:"h-5 w-5"}),s.jsx("span",{children:"Back to Products"})]})}),(0,s.jsxs)("div",{className:"rounded-xl bg-white p-8 shadow-sm",children:[s.jsx("h1",{className:"mb-6 text-2xl font-bold text-gray-900",children:"Add New Product"}),(0,s.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"barcode",className:"block text-sm font-medium text-gray-700",children:"Barcode (Auto-generated)"}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx("input",{id:"barcode",type:"text",required:!0,value:A.barcode,readOnly:!0,className:"block w-full rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-gray-700"}),s.jsx("button",{type:"button",onClick:()=>{let e=(0,b.S1)();F(r=>({...r,barcode:e})),h.Am.success("New barcode generated")},className:"rounded-lg bg-gray-100 p-2 text-gray-600 hover:bg-gray-200",title:"Generate new barcode",children:s.jsx(c.Z,{className:"h-5 w-5"})}),s.jsx("button",{type:"button",onClick:()=>{A.barcode&&(0,b.Ol)(A.barcode,A.name||"New Product",parseFloat(A.price)||void 0,r.symbol)},className:"rounded-lg bg-emerald-100 p-2 text-emerald-600 hover:bg-emerald-200",title:"Print barcode",children:s.jsx(u.Z,{className:"h-5 w-5"})}),s.jsx("button",{type:"button",onClick:()=>{A.barcode&&((0,b.E_)(A.barcode,A.name||"new-product"),h.Am.success("Barcode downloaded"))},className:"rounded-lg bg-blue-100 p-2 text-blue-600 hover:bg-blue-200",title:"Download barcode",children:s.jsx(m.Z,{className:"h-5 w-5"})})]}),s.jsx("div",{className:"mt-3 flex justify-center rounded-lg border border-gray-200 bg-white p-4",children:s.jsx("svg",{id:"barcode-preview",ref:S})})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),s.jsx("input",{id:"name",type:"text",required:!0,value:A.name,onChange:e=>F({...A,name:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),s.jsx("textarea",{id:"description",rows:3,value:A.description,onChange:e=>F({...A,description:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,s.jsxs)("div",{className:"grid gap-6 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category *"}),(0,s.jsxs)("select",{id:"category",required:!0,value:A.categoryId,onChange:e=>F({...A,categoryId:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[s.jsx("option",{value:"",children:"Select Category"}),j?.map?.(e=>s.jsx("option",{value:e?.id,children:e?.name},e?.id))??null]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price *"}),s.jsx("input",{id:"price",type:"number",step:"0.01",min:"0",required:!0,value:A.price,onChange:e=>F({...A,price:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"stock",className:"block text-sm font-medium text-gray-700",children:"Stock Quantity *"}),s.jsx("input",{id:"stock",type:"number",min:"0",required:!0,value:A.stock,onChange:e=>F({...A,stock:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"reorderLevel",className:"block text-sm font-medium text-gray-700",children:"Reorder Level"}),s.jsx("input",{id:"reorderLevel",type:"number",min:"0",value:A.reorderLevel,onChange:e=>F({...A,reorderLevel:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"supplier",className:"block text-sm font-medium text-gray-700",children:"Supplier"}),(0,s.jsxs)("select",{id:"supplier",value:A.supplierId,onChange:e=>F({...A,supplierId:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[s.jsx("option",{value:"",children:"Select Supplier (Optional)"}),w?.map?.(e=>s.jsx("option",{value:e?.id,children:e?.name},e?.id))??null]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700",children:"Product Image"}),(0,s.jsxs)("div",{className:"mt-1 flex items-center space-x-4",children:[(0,s.jsxs)("label",{className:"flex cursor-pointer items-center space-x-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-2 hover:border-emerald-500",children:[s.jsx(p.Z,{className:"h-5 w-5 text-gray-400"}),s.jsx("span",{className:"text-sm text-gray-600",children:_?"Uploading...":"Choose File"}),s.jsx("input",{id:"image",type:"file",accept:"image/*",onChange:E,disabled:_,className:"hidden"})]}),A.imageUrl&&s.jsx("span",{className:"text-sm text-green-600",children:"Image uploaded"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 border-t border-gray-200 pt-6",children:[s.jsx(x.default,{href:"/products",className:"rounded-lg bg-gray-200 px-6 py-2 font-medium text-gray-700 hover:bg-gray-300",children:"Cancel"}),s.jsx("button",{type:"submit",disabled:k||_,className:"flex items-center space-x-2 rounded-lg bg-emerald-600 px-6 py-2 font-medium text-white hover:bg-emerald-700 disabled:opacity-50",children:k?(0,s.jsxs)(s.Fragment,{children:[s.jsx(g.Z,{className:"h-5 w-5 animate-spin"}),s.jsx("span",{children:"Creating..."})]}):s.jsx("span",{children:"Create Product"})})]})]})]})]})]})]})})}},12458:(e,r,t)=>{"use strict";t.d(r,{p:()=>l});var s=t(62901),a=t(84700),o=t(84374);function l({children:e,allowedRoles:r,fallbackUrl:t="/dashboard"}){let{data:l,status:n}=(0,a.useSession)()||{};if((0,o.useRouter)(),"loading"===n)return s.jsx("div",{className:"flex min-h-screen items-center justify-center",children:s.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-emerald-600"})});if("authenticated"===n){let t=l?.user?.role;if(r?.includes?.(t))return s.jsx(s.Fragment,{children:e})}return null}t(24383)},52875:(e,r,t)=>{"use strict";t.d(r,{E_:()=>n,Ol:()=>l,S1:()=>o});var s=t(67774),a=t.n(s);function o(){let e=Date.now().toString().slice(-10)+Math.floor(100*Math.random()).toString().padStart(2,"0"),r=function(e){let r=0;for(let t=0;t<12;t++){let s=parseInt(e[t],10);r+=t%2==0?s:3*s}return((10-r%10)%10).toString()}(e);return e+r}function l(e,r,t,s){let a=window.open("","_blank","width=400,height=300");if(!a){alert("Please allow pop-ups to print barcode");return}let o=t?`${s||"KSh"} ${t.toFixed(2)}`:"";a.document.write(`
    <!DOCTYPE html>
    <html>
      <head>
        <title>Print Barcode - ${r}</title>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          body {
            margin: 0;
            padding: 5mm;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
          }
          .label {
            text-align: center;
            width: 50mm;
          }
          .product-name {
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 2mm;
            max-width: 50mm;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          }
          .price {
            font-size: 12px;
            font-weight: bold;
            margin-top: 2mm;
          }
          svg {
            max-width: 50mm;
          }
        </style>
      </head>
      <body>
        <div class="label">
          <div class="product-name">${r}</div>
          <svg id="barcode"></svg>
          ${o?`<div class="price">${o}</div>`:""}
        </div>
        <script>
          JsBarcode("#barcode", "${e}", {
            format: "EAN13",
            width: 1.5,
            height: 50,
            displayValue: true,
            fontSize: 12,
            margin: 5
          });
          window.onload = () => {
            setTimeout(() => {
              window.print();
              window.close();
            }, 300);
          };
        </script>
      </body>
    </html>
  `),a.document.close()}function n(e,r){let t=document.createElement("canvas");a()(t,e,{format:"EAN13",width:2,height:80,displayValue:!0,fontSize:14,margin:10});let s=document.createElement("a");s.download=`barcode-${r.replace(/\s+/g,"-").toLowerCase()}.png`,s.href=t.toDataURL("image/png"),s.click()}},75909:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(71945).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},10333:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(71945).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},91464:(e,r,t)=>{"use strict";t.d(r,{Z:()=>s});let s=(0,t(71945).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},71617:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>s});let s=(0,t(88895).createProxy)(String.raw`/home/ubuntu/supermarket_pos_system/nextjs_space/app/products/new/page.tsx#default`)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4372,879,9121,2620,4542,4566],()=>t(25743));module.exports=s})();