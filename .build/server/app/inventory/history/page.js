(()=>{var e={};e.id=1352,e.ids=[1352],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},41541:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>d}),s(99446),s(32694),s(71363);var r=s(36576),a=s(72007),n=s(21818),i=s.n(n),l=s(88897),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["inventory",{children:["history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,99446)),"/home/ubuntu/supermarket_pos_system/nextjs_space/app/inventory/history/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,32694)),"/home/ubuntu/supermarket_pos_system/nextjs_space/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,71363,23)),"next/dist/client/components/not-found-error"]}],c=["/home/ubuntu/supermarket_pos_system/nextjs_space/app/inventory/history/page.tsx"],x="/inventory/history/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/inventory/history/page",pathname:"/inventory/history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},13410:(e,t,s)=>{Promise.resolve().then(s.bind(s,98473))},98473:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>y});var r=s(62901),a=s(73735),n=s(12458),i=s(92861),l=s(24383),o=s(10508),d=s(68734),c=s(91046),x=s(68537),m=s(39350),u=s(59617),p=s(74190),h=s(72632);function y(){let{selectedStore:e}=(0,u.o)(),{formatPrice:t}=(0,p.U8)(),[s,y]=(0,l.useState)([]),[g,f]=(0,l.useState)(!0),[j,b]=(0,l.useState)(""),[v,N]=(0,l.useState)(""),[w,_]=(0,l.useState)(""),[k,S]=(0,l.useState)(""),A=async()=>{try{f(!0);let t=`/api/inventory/history?storeId=${e?.id}`;v&&(t+=`&type=${v}`),w&&(t+=`&dateFrom=${w}`),k&&(t+=`&dateTo=${k}`),j&&(t+=`&search=${j}`);let s=await fetch(t),r=await s.json();y(r)}catch(e){console.error("Error fetching history:",e),m.Am.error("Failed to fetch inventory history")}finally{f(!1)}},T=()=>{A()},E=e=>{switch(e){case"RESTOCK":return"bg-green-100 text-green-700";case"SALE":return"bg-blue-100 text-blue-700";case"DAMAGE":return"bg-red-100 text-red-700";case"LOSS":return"bg-orange-100 text-orange-700";case"ADJUSTMENT":return"bg-purple-100 text-purple-700";case"RETURN":return"bg-cyan-100 text-cyan-700";default:return"bg-gray-100 text-gray-700"}};return r.jsx(a.I,{children:(0,r.jsxs)(n.p,{allowedRoles:["ADMIN","MANAGER","INVENTORY_CLERK"],children:[r.jsx(m.x7,{position:"top-right"}),(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(i.W,{}),r.jsx("main",{className:"lg:ml-64 pt-16",children:(0,r.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"mb-8 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[r.jsx(o.Z,{className:"h-8 w-8 text-emerald-600"}),"Inventory History"]}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Track all inventory changes with date, time, and user"})]}),(0,r.jsxs)("button",{onClick:()=>{let e=s.map(e=>({Reference:e.referenceNumber,Date:new Date(e.createdAt).toLocaleDateString(),Time:new Date(e.createdAt).toLocaleTimeString(),Product:e.product.name,Barcode:e.product.barcode,Type:e.type,Before:e.quantityBefore,Change:e.quantityChange>0?`+${e.quantityChange}`:e.quantityChange,After:e.quantityAfter,User:e.user.name,Reason:e.reason||"-"})),t=h.P6.json_to_sheet(e),r=h.P6.book_new();h.P6.book_append_sheet(r,t,"Inventory History"),h.NC(r,`inventory_history_${new Date().toISOString().split("T")[0]}.xlsx`),m.Am.success("History exported")},disabled:0===s.length,className:"flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 font-medium text-white hover:bg-emerald-700 disabled:bg-gray-300",children:[r.jsx(d.Z,{className:"h-5 w-5"}),"Export Excel"]})]}),r.jsx("div",{className:"mb-6 rounded-xl bg-white p-6 shadow-sm",children:(0,r.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-5",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Search"}),(0,r.jsxs)("div",{className:"relative",children:[r.jsx(c.Z,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",value:j,onChange:e=>b(e.target.value),onKeyDown:e=>"Enter"===e.key&&T(),placeholder:"Product or barcode...",className:"w-full rounded-lg border border-gray-300 pl-10 pr-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),(0,r.jsxs)("select",{value:v,onChange:e=>N(e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[r.jsx("option",{value:"",children:"All Types"}),r.jsx("option",{value:"RESTOCK",children:"Restock"}),r.jsx("option",{value:"SALE",children:"Sale"}),r.jsx("option",{value:"DAMAGE",children:"Damage"}),r.jsx("option",{value:"LOSS",children:"Loss"}),r.jsx("option",{value:"ADJUSTMENT",children:"Adjustment"}),r.jsx("option",{value:"RETURN",children:"Return"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"From Date"}),r.jsx("input",{type:"date",value:w,onChange:e=>_(e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"To Date"}),r.jsx("input",{type:"date",value:k,onChange:e=>S(e.target.value),className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),r.jsx("div",{className:"flex items-end",children:(0,r.jsxs)("button",{onClick:T,className:"w-full rounded-lg bg-emerald-600 px-4 py-2 font-medium text-white hover:bg-emerald-700",children:[r.jsx(x.Z,{className:"inline h-4 w-4 mr-2"}),"Apply"]})})]})}),r.jsx("div",{className:"rounded-xl bg-white shadow-sm overflow-hidden",children:g?r.jsx("div",{className:"flex items-center justify-center py-12",children:r.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-emerald-600"})}):s.length>0?r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[r.jsx("thead",{className:"bg-gray-50",children:(0,r.jsxs)("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date & Time"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reference"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Product"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Change"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Stock"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[r.jsx("div",{className:"font-medium text-gray-900",children:new Date(e.createdAt).toLocaleDateString()}),r.jsx("div",{className:"text-gray-500",children:new Date(e.createdAt).toLocaleTimeString()})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.referenceNumber}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.product.name}),r.jsx("div",{className:"text-xs text-gray-500",children:e.product.barcode})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${E(e.type)}`,children:e.type})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,r.jsxs)("span",{className:e.quantityChange>=0?"text-green-600 font-medium":"text-red-600 font-medium",children:[e.quantityChange>=0?"+":"",e.quantityChange]})}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.quantityBefore," â†’ ",e.quantityAfter]}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.user.name}),r.jsx("div",{className:"text-xs text-gray-500",children:e.user.email})]}),r.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 max-w-xs truncate",children:e.reason||"-"})]},e.id))})]})}):(0,r.jsxs)("div",{className:"py-12 text-center",children:[r.jsx(o.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),r.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No history found"}),r.jsx("p",{className:"mt-2 text-gray-500",children:"Inventory changes will appear here"})]})})]})})]})]})})}},12458:(e,t,s)=>{"use strict";s.d(t,{p:()=>i});var r=s(62901),a=s(84700),n=s(84374);function i({children:e,allowedRoles:t,fallbackUrl:s="/dashboard"}){let{data:i,status:l}=(0,a.useSession)()||{};if((0,n.useRouter)(),"loading"===l)return r.jsx("div",{className:"flex min-h-screen items-center justify-center",children:r.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-emerald-600"})});if("authenticated"===l){let s=i?.user?.role;if(t?.includes?.(s))return r.jsx(r.Fragment,{children:e})}return null}s(24383)},68537:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(71945).Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},91046:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});let r=(0,s(71945).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},99446:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(88895).createProxy)(String.raw`/home/ubuntu/supermarket_pos_system/nextjs_space/app/inventory/history/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4372,879,9121,3030,4542,4566],()=>s(41541));module.exports=r})();