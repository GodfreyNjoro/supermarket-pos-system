"use strict";(()=>{var e={};e.id=9636,e.ids=[9636],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},89140:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>q,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>x,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var t={};s.r(t),s.d(t,{GET:()=>d,POST:()=>m,dynamic:()=>p});var n=s(79182),o=s(72007),i=s(56719),a=s(93442),u=s(35970),c=s(57978),l=s(86023);let p="force-dynamic";async function d(e){try{let{searchParams:r}=new URL(e.url),s=r.get("search"),t={};s&&(t.OR=[{name:{contains:s,mode:"insensitive"}},{phone:{contains:s,mode:"insensitive"}},{email:{contains:s,mode:"insensitive"}}]);let n=await u._.customer.findMany({where:t,include:{_count:{select:{sales:!0}}},orderBy:{name:"asc"}});return a.NextResponse.json(n)}catch(e){return console.error("Error fetching customers:",e),a.NextResponse.json({error:"Failed to fetch customers"},{status:500})}}async function m(e){try{if(!await (0,c.getServerSession)(l.L))return a.NextResponse.json({error:"Unauthorized"},{status:401});let{name:r,phone:s,email:t}=await e.json();if(!r)return a.NextResponse.json({error:"Name is required"},{status:400});if(s&&await u._.customer.findUnique({where:{phone:s}}))return a.NextResponse.json({error:"Customer with this phone already exists"},{status:400});if(t&&await u._.customer.findUnique({where:{email:t}}))return a.NextResponse.json({error:"Customer with this email already exists"},{status:400});let n=await u._.customer.create({data:{name:r,phone:s||null,email:t||null}});return a.NextResponse.json(n,{status:201})}catch(e){return console.error("Error creating customer:",e),a.NextResponse.json({error:"Failed to create customer"},{status:500})}}let x=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/customers/route",pathname:"/api/customers",filename:"route",bundlePath:"app/api/customers/route"},resolvedPagePath:"/home/ubuntu/supermarket_pos_system/nextjs_space/app/api/customers/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:y}=x,q="/api/customers/route";function f(){return(0,i.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}},86023:(e,r,s)=>{s.d(r,{L:()=>l,X:()=>p});var t=s(66291),n=s(64617),o=s(35970),i=s(3390),a=s.n(i),u=s(84770),c=s.n(u);let l={adapter:(0,n.N)(o._),providers:[(0,t.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let r=await o._.user.findUnique({where:{email:e.email}});if(!r||!r.isActive||!await a().compare(e.password,r.password))return null;let s=c().randomBytes(32).toString("hex");return await o._.user.update({where:{id:r.id},data:{sessionToken:s,lastLoginAt:new Date}}),{id:r.id,email:r.email,name:r.name,role:r.role,storeId:r.storeId,sessionToken:s}}})],callbacks:{jwt:async({token:e,user:r})=>(r&&(e.id=r.id,e.role=r.role,e.storeId=r.storeId,e.sessionToken=r.sessionToken),e),session:async({session:e,token:r})=>(e?.user&&(e.user.id=r.id,e.user.role=r.role,e.user.storeId=r.storeId,e.user.sessionToken=r.sessionToken),e)},pages:{signIn:"/"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET};async function p(e,r){let s=await o._.user.findUnique({where:{id:e},select:{sessionToken:!0,isActive:!0}});return!!s&&!!s.isActive&&s.sessionToken===r}},35970:(e,r,s)=>{s.d(r,{_:()=>n});let t=require("@prisma/client"),n=globalThis.prisma??new t.PrismaClient}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[4372,7609,3390,1472],()=>s(89140));module.exports=t})();