"use strict";(()=>{var e={};e.id=8320,e.ids=[8320],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},8678:e=>{e.exports=import("pg")},19621:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{originalPathname:()=>x,patchFetch:()=>p,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var a=t(79182),i=t(72007),n=t(56719),o=t(8229),u=e([o]);o=(u.then?(await u)():u)[0];let l=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/settings/database/init/route",pathname:"/api/settings/database/init",filename:"route",bundlePath:"app/api/settings/database/init/route"},resolvedPagePath:"/home/ubuntu/supermarket_pos_system/nextjs_space/app/api/settings/database/init/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:m}=l,x="/api/settings/database/init/route";function p(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}r()}catch(e){r(e)}})},8229:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{POST:()=>p});var a=t(93442),i=t(57978),n=t(86023),o=t(8678),u=e([o]);async function p(e){try{let s=await (0,i.getServerSession)(n.L);if(!s||s.user?.role!=="ADMIN")return a.NextResponse.json({success:!1,message:"Unauthorized"},{status:401});let{host:t,port:r,database:u,username:p,password:l}=await e.json(),d=new o.Client({host:t,port:parseInt(r,10),database:u,user:p,password:l,connectionTimeoutMillis:1e4});if(await d.connect(),!(await d.query(`
      SELECT EXISTS (
        SELECT FROM information_schema.tables 
        WHERE table_schema = 'public' 
        AND table_name = 'User'
      );
    `)).rows[0].exists)return a.NextResponse.json({success:!0,message:'Database connected. Run "yarn prisma migrate deploy" to initialize schema.',needsMigration:!0});return await d.end(),a.NextResponse.json({success:!0,message:"Database initialized and ready",needsMigration:!1})}catch(e){return console.error("Database init failed:",e),a.NextResponse.json({success:!1,message:e.message||"Failed to initialize database"},{status:500})}}o=(u.then?(await u)():u)[0],r()}catch(e){r(e)}})},86023:(e,s,t)=>{t.d(s,{L:()=>l,X:()=>d});var r=t(66291),a=t(64617),i=t(35970),n=t(3390),o=t.n(n),u=t(84770),p=t.n(u);let l={adapter:(0,a.N)(i._),providers:[(0,r.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let s=await i._.user.findUnique({where:{email:e.email}});if(!s||!s.isActive||!await o().compare(e.password,s.password))return null;let t=p().randomBytes(32).toString("hex");return await i._.user.update({where:{id:s.id},data:{sessionToken:t,lastLoginAt:new Date}}),{id:s.id,email:s.email,name:s.name,role:s.role,storeId:s.storeId,sessionToken:t}}})],callbacks:{jwt:async({token:e,user:s})=>(s&&(e.id=s.id,e.role=s.role,e.storeId=s.storeId,e.sessionToken=s.sessionToken),e),session:async({session:e,token:s})=>(e?.user&&(e.user.id=s.id,e.user.role=s.role,e.user.storeId=s.storeId,e.user.sessionToken=s.sessionToken),e)},pages:{signIn:"/"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET};async function d(e,s){let t=await i._.user.findUnique({where:{id:e},select:{sessionToken:!0,isActive:!0}});return!!t&&!!t.isActive&&t.sessionToken===s}},35970:(e,s,t)=>{t.d(s,{_:()=>a});let r=require("@prisma/client"),a=globalThis.prisma??new r.PrismaClient}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4372,7609,3390,1472],()=>t(19621));module.exports=r})();