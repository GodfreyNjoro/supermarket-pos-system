"use strict";(()=>{var e={};e.id=9087,e.ids=[9087],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},8678:e=>{e.exports=import("pg")},71246:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{originalPathname:()=>x,patchFetch:()=>p,requestAsyncStorage:()=>l,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a=t(79182),n=t(72007),i=t(56719),o=t(77878),u=e([o]);o=(u.then?(await u)():u)[0];let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/settings/database/test/route",pathname:"/api/settings/database/test",filename:"route",bundlePath:"app/api/settings/database/test/route"},resolvedPagePath:"/home/ubuntu/supermarket_pos_system/nextjs_space/app/api/settings/database/test/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:m}=c,x="/api/settings/database/test/route";function p(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}r()}catch(e){r(e)}})},77878:(e,s,t)=>{t.a(e,async(e,r)=>{try{t.r(s),t.d(s,{POST:()=>p});var a=t(93442),n=t(57978),i=t(86023),o=t(8678),u=e([o]);async function p(e){try{let s=await (0,n.getServerSession)(i.L);if(!s||s.user?.role!=="ADMIN")return a.NextResponse.json({success:!1,message:"Unauthorized"},{status:401});let{host:t,port:r,database:u,username:p,password:c}=await e.json();if(!t||!r||!u||!p)return a.NextResponse.json({success:!1,message:"Missing required fields"},{status:400});let l=new o.Client({host:t,port:parseInt(r,10),database:u,user:p,password:c,connectionTimeoutMillis:5e3});await l.connect();let d=await l.query("SELECT version()"),m=d.rows[0]?.version||"Unknown";return await l.end(),a.NextResponse.json({success:!0,message:`Connected successfully! PostgreSQL ${m.split(" ")[1]||""}`})}catch(s){console.error("Database connection test failed:",s);let e="Connection failed";return"ECONNREFUSED"===s.code?e="Connection refused. Is PostgreSQL running?":"28P01"===s.code?e="Authentication failed. Check username/password.":"3D000"===s.code?e="Database does not exist.":s.message&&(e=s.message),a.NextResponse.json({success:!1,message:e},{status:400})}}o=(u.then?(await u)():u)[0],r()}catch(e){r(e)}})},86023:(e,s,t)=>{t.d(s,{L:()=>c,X:()=>l});var r=t(66291),a=t(64617),n=t(35970),i=t(3390),o=t.n(i),u=t(84770),p=t.n(u);let c={adapter:(0,a.N)(n._),providers:[(0,r.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let s=await n._.user.findUnique({where:{email:e.email}});if(!s||!s.isActive||!await o().compare(e.password,s.password))return null;let t=p().randomBytes(32).toString("hex");return await n._.user.update({where:{id:s.id},data:{sessionToken:t,lastLoginAt:new Date}}),{id:s.id,email:s.email,name:s.name,role:s.role,storeId:s.storeId,sessionToken:t}}})],callbacks:{jwt:async({token:e,user:s})=>(s&&(e.id=s.id,e.role=s.role,e.storeId=s.storeId,e.sessionToken=s.sessionToken),e),session:async({session:e,token:s})=>(e?.user&&(e.user.id=s.id,e.user.role=s.role,e.user.storeId=s.storeId,e.user.sessionToken=s.sessionToken),e)},pages:{signIn:"/"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET};async function l(e,s){let t=await n._.user.findUnique({where:{id:e},select:{sessionToken:!0,isActive:!0}});return!!t&&!!t.isActive&&t.sessionToken===s}},35970:(e,s,t)=>{t.d(s,{_:()=>a});let r=require("@prisma/client"),a=globalThis.prisma??new r.PrismaClient}};var s=require("../../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[4372,7609,3390,1472],()=>t(71246));module.exports=r})();