exports.id=4542,exports.ids=[4542],exports.modules={1753:(e,t,s)=>{Promise.resolve().then(s.bind(s,13937))},87133:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,84114,23)),Promise.resolve().then(s.t.bind(s,28866,23)),Promise.resolve().then(s.t.bind(s,31324,23)),Promise.resolve().then(s.t.bind(s,83567,23)),Promise.resolve().then(s.t.bind(s,55996,23)),Promise.resolve().then(s.t.bind(s,10050,23))},13937:(e,t,s)=>{"use strict";s.d(t,{Providers:()=>A});var r=s(62901),a=s(84700),n=s(24383),o=s(69878);function i({children:e,...t}){return r.jsx(o.f,{...t,children:e})}var c=s(24264),l=s(60437);class d{constructor(){this.isSyncing=!1}static getInstance(){return d.instance||(d.instance=new d),d.instance}async syncAllTransactions(){if(this.isSyncing){console.log("[SyncManager] Sync already in progress");return}if(!navigator.onLine){console.log("[SyncManager] Device is offline, skipping sync");return}this.isSyncing=!0,console.log("[SyncManager] Starting sync...");try{let e=await c.N.getUnsyncedTransactions();if(console.log(`[SyncManager] Found ${e.length} unsynced transactions`),0===e.length){this.isSyncing=!1;return}let t={success:0,failed:0};for(let s of e)try{await this.syncTransaction(s),await c.N.markTransactionSynced(s.id),t.success++}catch(e){console.error("[SyncManager] Failed to sync transaction:",s.id,e),t.failed++}console.log("[SyncManager] Sync completed:",t),t.success>0&&(0,l.Am)({title:"Sync Complete",description:`Successfully synced ${t.success} transaction(s)${t.failed>0?`. ${t.failed} failed.`:""}`}),t.failed>0&&(0,l.Am)({title:"Sync Warning",description:`${t.failed} transaction(s) failed to sync. Will retry on next sync.`,variant:"destructive"})}catch(e){console.error("[SyncManager] Sync error:",e),(0,l.Am)({title:"Sync Error",description:"Failed to sync offline transactions. Will retry later.",variant:"destructive"})}finally{this.isSyncing=!1}}async syncTransaction(e){switch(e.type){case"sale":return this.syncSale(e.data);case"product":return this.syncProduct(e.data);case"customer":return this.syncCustomer(e.data);case"return":return this.syncReturn(e.data);default:throw Error(`Unknown transaction type: ${e.type}`)}}async syncSale(e){let t=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`Failed to sync sale: ${t.statusText}`)}async syncProduct(e){let t=e.id?"PUT":"POST",s=e.id?`/api/products/${e.id}`:"/api/products",r=await fetch(s,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error(`Failed to sync product: ${r.statusText}`)}async syncCustomer(e){let t=e.id?"PUT":"POST",s=e.id?`/api/customers/${e.id}`:"/api/customers",r=await fetch(s,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw Error(`Failed to sync customer: ${r.statusText}`)}async syncReturn(e){let t=await fetch("/api/returns",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`Failed to sync return: ${t.statusText}`)}async cacheDataForOffline(){try{let e=await fetch("/api/products");if(e.ok){let t=await e.json();await c.N.cacheProducts(t)}let t=await fetch("/api/customers");if(t.ok){let e=await t.json();await c.N.cacheCustomers(e)}let s=await fetch("/api/categories");if(s.ok){let e=await s.json();await c.N.cacheCategories(e)}console.log("[SyncManager] Data cached successfully")}catch(e){console.error("[SyncManager] Failed to cache data:",e)}}}function u(){return null}d.getInstance();var m=s(68734),p=s(42594),f=s(27878);function h(){let[e,t]=(0,n.useState)(null),[s,a]=(0,n.useState)(!1),o=async()=>{if(!e)return;e.prompt();let{outcome:s}=await e.userChoice;"accepted"===s?console.log("[InstallPrompt] User accepted the install prompt"):console.log("[InstallPrompt] User dismissed the install prompt"),t(null),a(!1)},i=()=>{a(!1)};return s?r.jsx("div",{className:"fixed bottom-4 right-4 z-50 max-w-sm animate-in slide-in-from-bottom",children:r.jsx("div",{className:"rounded-lg bg-white p-4 shadow-lg border border-gray-200",children:(0,r.jsxs)("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(m.Z,{className:"h-6 w-6 text-emerald-600"})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Install POS System"}),r.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Install this app on your desktop for quick access and offline support!"}),(0,r.jsxs)("div",{className:"mt-3 flex space-x-2",children:[r.jsx(f.z,{onClick:o,size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",children:"Install"}),r.jsx(f.z,{onClick:i,size:"sm",variant:"outline",children:"Not now"})]})]}),r.jsx("button",{onClick:i,className:"flex-shrink-0 text-gray-400 hover:text-gray-600",children:r.jsx(p.Z,{className:"h-5 w-5"})})]})})}):null}var y=s(91283),g=s(47279),x=s(68637);let S=y.zt,b=n.forwardRef(({className:e,...t},s)=>r.jsx(y.l_,{ref:s,className:(0,x.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));b.displayName=y.l_.displayName;let v=(0,g.j)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),w=n.forwardRef(({className:e,variant:t,...s},a)=>r.jsx(y.fC,{ref:a,className:(0,x.cn)(v({variant:t}),e),...s}));w.displayName=y.fC.displayName,n.forwardRef(({className:e,...t},s)=>r.jsx(y.aU,{ref:s,className:(0,x.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t})).displayName=y.aU.displayName;let j=n.forwardRef(({className:e,...t},s)=>r.jsx(y.x8,{ref:s,className:(0,x.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:r.jsx(p.Z,{className:"h-4 w-4"})}));j.displayName=y.x8.displayName;let N=n.forwardRef(({className:e,...t},s)=>r.jsx(y.Dx,{ref:s,className:(0,x.cn)("text-sm font-semibold",e),...t}));N.displayName=y.Dx.displayName;let P=n.forwardRef(({className:e,...t},s)=>r.jsx(y.dk,{ref:s,className:(0,x.cn)("text-sm opacity-90",e),...t}));function T(){let{toasts:e}=(0,l.pm)();return(0,r.jsxs)(S,{children:[e.map(function({id:e,title:t,description:s,action:a,...n}){return(0,r.jsxs)(w,{...n,children:[(0,r.jsxs)("div",{className:"grid gap-1",children:[t&&r.jsx(N,{children:t}),s&&r.jsx(P,{children:s})]}),a,r.jsx(j,{})]},e)}),r.jsx(b,{})]})}P.displayName=y.dk.displayName;var I=s(59617),k=s(74190),C=s(23415);function A({children:e}){let[t,s]=(0,n.useState)(!1);return t?r.jsx(a.SessionProvider,{children:r.jsx(I.g,{children:r.jsx(k.T3,{children:r.jsx(C.Hn,{children:(0,r.jsxs)(i,{attribute:"class",defaultTheme:"light",enableSystem:!0,disableTransitionOnChange:!0,children:[r.jsx(u,{}),r.jsx(h,{}),r.jsx(T,{}),e]})})})})}):null}},23415:(e,t,s)=>{"use strict";s.d(t,{Ap:()=>i,FE:()=>l,Hn:()=>c});var r=s(62901),a=s(84700),n=s(24383);let o=(0,n.createContext)({isPinned:!0,setIsPinned:e=>{}}),i=()=>(0,n.useContext)(o);function c({children:e}){let[t,s]=(0,n.useState)(!0);return r.jsx(o.Provider,{value:{isPinned:t,setIsPinned:s},children:e})}function l({children:e}){let{data:t}=(0,a.useSession)()||{},s=t?.user?.role,{isPinned:n}=i();return"CASHIER"===s?r.jsx("main",{children:e}):r.jsx("main",{className:`min-h-screen pt-16 transition-all duration-300 ${n?"lg:ml-64":"lg:ml-16"}`,children:e})}},27878:(e,t,s)=>{"use strict";s.d(t,{z:()=>l});var r=s(62901),a=s(24383),n=s(42049),o=s(47279),i=s(68637);let c=(0,o.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef(({className:e,variant:t,size:s,asChild:a=!1,...o},l)=>{let d=a?n.g7:"button";return r.jsx(d,{className:(0,i.cn)(c({variant:t,size:s,className:e})),ref:l,...o})});l.displayName="Button"},60437:(e,t,s)=>{"use strict";s.d(t,{Am:()=>u,pm:()=>m});var r=s(24383);let a=0,n=new Map,o=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?o(s):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],l={toasts:[]};function d(e){l=i(l,e),c.forEach(e=>{e(l)})}function u({...e}){let t=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:t});return d({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||s()}}}),{id:t,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function m(){let[e,t]=r.useState(l);return r.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},74190:(e,t,s)=>{"use strict";s.d(t,{Mf:()=>n,T3:()=>i,U8:()=>c});var r=s(62901),a=s(24383);let n=[{code:"KES",symbol:"KSh",name:"Kenyan Shilling",rate:1},{code:"USD",symbol:"$",name:"US Dollar",rate:.0065},{code:"EUR",symbol:"€",name:"Euro",rate:.006},{code:"GBP",symbol:"\xa3",name:"British Pound",rate:.0051},{code:"TZS",symbol:"TSh",name:"Tanzanian Shilling",rate:16.5},{code:"UGX",symbol:"USh",name:"Ugandan Shilling",rate:24},{code:"ZAR",symbol:"R",name:"South African Rand",rate:.12},{code:"NGN",symbol:"₦",name:"Nigerian Naira",rate:10}],o=(0,a.createContext)(void 0);function i({children:e}){let[t,s]=(0,a.useState)(n[0]),[i,c]=(0,a.useState)(!1),l=e=>e*t.rate,d={currency:i?t:n[0],setCurrency:e=>{s(e),localStorage.setItem("pos-currency",e.code)},formatPrice:i?e=>{let s=l(e);return`${t.symbol} ${s.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`}:e=>`KSh ${e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}`,convertPrice:i?l:e=>e};return r.jsx(o.Provider,{value:d,children:e})}function c(){let e=(0,a.useContext)(o);if(!e)throw Error("useCurrency must be used within a CurrencyProvider");return e}},59617:(e,t,s)=>{"use strict";s.d(t,{g:()=>i,o:()=>c});var r=s(62901),a=s(24383),n=s(84700);let o=(0,a.createContext)(void 0);function i({children:e}){let{data:t,status:s}=(0,n.useSession)()||{},[i,c]=(0,a.useState)(null),[l,d]=(0,a.useState)([]),[u,m]=(0,a.useState)(!0),p=async()=>{try{m(!0);let e=await fetch("/api/stores");if(e.ok){let s=await e.json();if(d(s),t?.user){let e=t.user?.storeId;if(e){let t=s.find(t=>t.id===e);t&&(c(t),localStorage.setItem("selectedStoreId",t.id))}else{let e=localStorage.getItem("selectedStoreId");if(e){let t=s.find(t=>t.id===e);if(t)c(t);else{let e=s.find(e=>e.isActive);e&&(c(e),localStorage.setItem("selectedStoreId",e.id))}}else{let e=s.find(e=>e.isActive);e&&(c(e),localStorage.setItem("selectedStoreId",e.id))}}}}}catch(e){console.error("Error fetching stores:",e)}finally{m(!1)}};return r.jsx(o.Provider,{value:{selectedStore:i,setSelectedStore:e=>{c(e),e?localStorage.setItem("selectedStoreId",e.id):localStorage.removeItem("selectedStoreId")},stores:l,loading:u,refreshStores:p},children:e})}function c(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useStore must be used within a StoreProvider");return e}},24264:(e,t,s)=>{"use strict";s.d(t,{N:()=>a});class r{async init(){return new Promise((e,t)=>{let s=indexedDB.open("pos_offline_db",1);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("transactions")){let e=t.createObjectStore("transactions",{keyPath:"id"});e.createIndex("synced","synced",{unique:!1}),e.createIndex("type","type",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}t.objectStoreNames.contains("products")||t.createObjectStore("products",{keyPath:"id"}),t.objectStoreNames.contains("customers")||t.createObjectStore("customers",{keyPath:"id"}),t.objectStoreNames.contains("categories")||t.createObjectStore("categories",{keyPath:"id"})}})}async addTransaction(e){return this.db||await this.init(),new Promise((t,s)=>{let r=this.db.transaction("transactions","readwrite").objectStore("transactions").add(e);r.onsuccess=()=>t(),r.onerror=()=>s(r.error)})}async getUnsyncedTransactions(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("transactions","readonly").objectStore("transactions").index("synced").getAll(IDBKeyRange.only(!1));s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async markTransactionSynced(e){return this.db||await this.init(),new Promise((t,s)=>{let r=this.db.transaction("transactions","readwrite").objectStore("transactions"),a=r.get(e);a.onsuccess=()=>{let e=a.result;if(e){e.synced=!0;let a=r.put(e);a.onsuccess=()=>t(),a.onerror=()=>s(a.error)}else t()},a.onerror=()=>s(a.error)})}async cacheProducts(e){return this.db||await this.init(),new Promise((t,s)=>{let r=this.db.transaction("products","readwrite"),a=r.objectStore("products");a.clear().onsuccess=()=>{e.forEach(e=>{a.add(e)})},r.oncomplete=()=>t(),r.onerror=()=>s(r.error)})}async getCachedProducts(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("products","readonly").objectStore("products").getAll();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async cacheCustomers(e){return this.db||await this.init(),new Promise((t,s)=>{let r=this.db.transaction("customers","readwrite"),a=r.objectStore("customers");a.clear().onsuccess=()=>{e.forEach(e=>{a.add(e)})},r.oncomplete=()=>t(),r.onerror=()=>s(r.error)})}async getCachedCustomers(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("customers","readonly").objectStore("customers").getAll();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async cacheCategories(e){return this.db||await this.init(),new Promise((t,s)=>{let r=this.db.transaction("categories","readwrite"),a=r.objectStore("categories");a.clear().onsuccess=()=>{e.forEach(e=>{a.add(e)})},r.oncomplete=()=>t(),r.onerror=()=>s(r.error)})}async getCachedCategories(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("categories","readonly").objectStore("categories").getAll();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}constructor(){this.db=null}}let a=new r},68637:(e,t,s)=>{"use strict";s.d(t,{cn:()=>n});var r=s(84330),a=s(77189);function n(...e){return(0,a.m6)((0,r.W)(e))}},32694:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,dynamic:()=>i,metadata:()=>c,viewport:()=>l});var r=s(83537),a=s(57416),n=s.n(a);s(26148);let o=(0,s(88895).createProxy)(String.raw`/home/ubuntu/supermarket_pos_system/nextjs_space/app/providers.tsx#Providers`),i="force-dynamic",c={metadataBase:new URL(process.env.NEXTAUTH_URL||"http://localhost:3000"),title:"Supermarket POS System",description:"Comprehensive point of sale system for supermarkets with offline support",manifest:"/manifest.json",icons:{icon:"/favicon.svg",shortcut:"/favicon.svg",apple:"/favicon.svg"},openGraph:{images:["/og-image.png"]},appleWebApp:{capable:!0,statusBarStyle:"default",title:"POS System"}},l={width:"device-width",initialScale:1,maximumScale:1,userScalable:!1};function d({children:e}){return(0,r.jsxs)("html",{lang:"en",suppressHydrationWarning:!0,children:[(0,r.jsxs)("head",{children:[r.jsx("meta",{name:"application-name",content:"POS System"}),r.jsx("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),r.jsx("meta",{name:"apple-mobile-web-app-status-bar-style",content:"default"}),r.jsx("meta",{name:"apple-mobile-web-app-title",content:"POS System"}),r.jsx("meta",{name:"format-detection",content:"telephone=no"}),r.jsx("meta",{name:"mobile-web-app-capable",content:"yes"}),r.jsx("meta",{name:"theme-color",content:"#10b981"}),r.jsx("link",{rel:"apple-touch-icon",href:"/favicon.svg"}),r.jsx("script",{src:"https://apps.abacus.ai/chatllm/appllm-lib.js"})]}),r.jsx("body",{className:n().className,children:r.jsx(o,{children:e})})]})}},26148:()=>{}};