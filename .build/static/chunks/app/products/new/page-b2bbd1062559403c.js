(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{77838:function(e,r,t){Promise.resolve().then(t.bind(t,87139))},87139:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return j}});var a=t(15444),o=t(46271),s=t(11117),l=t(3763),n=t(89300),i=t(79047),d=t(98155),c=t(81471),u=t(85011),m=t(26584),p=t(4805),g=t(1946),h=t(41084),f=t(64611),x=t(14757),b=t(3857),y=t(82534);function j(){let e=(0,i.useRouter)(),{currency:r}=(0,b.U8)(),{selectedStore:t}=(0,y.o)(),[j,v]=(0,n.useState)([]),[w,N]=(0,n.useState)([]),[k,S]=(0,n.useState)(!1),[C,E]=(0,n.useState)(!1),P=(0,n.useRef)(null),[A,F]=(0,n.useState)({barcode:"",name:"",description:"",price:"",stock:"",reorderLevel:"10",categoryId:"",supplierId:"",imageUrl:"",cloud_storage_path:"",isPublic:!0});(0,n.useEffect)(()=>{I(),Z();let e=(0,x.S1)();F(r=>({...r,barcode:e}))},[]),(0,n.useEffect)(()=>{if(A.barcode&&13===A.barcode.length){let e=setTimeout(()=>{document.getElementById("barcode-preview")&&(0,x.AI)(A.barcode,"barcode-preview")},200);return()=>clearTimeout(e)}},[A.barcode]);let I=async()=>{try{let e=await fetch("/api/categories"),r=await e.json();v(r)}catch(e){console.error("Error fetching categories:",e)}},Z=async()=>{try{let e=await fetch("/api/suppliers"),r=await e.json();N(r)}catch(e){console.error("Error fetching suppliers:",e)}},_=async e=>{let r=e.target.files?.[0];if(r)try{E(!0);let e=await fetch("/api/products/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fileName:r.name,contentType:r.type,isPublic:!0})});if(!e.ok)throw Error("Failed to get upload URL");let{uploadUrl:t,cloud_storage_path:a}=await e.json(),o=new URL(t).searchParams.get("X-Amz-SignedHeaders"),s=o?.includes?.("content-disposition"),l={"Content-Type":r.type};if(s&&(l["Content-Disposition"]="attachment"),!(await fetch(t,{method:"PUT",headers:l,body:r})).ok)throw Error("Failed to upload file");let n=await fetch(`/api/products/upload?cloud_storage_path=${encodeURIComponent(a)}&isPublic=true`),i=(await n.json()).url;F(e=>({...e,imageUrl:i,cloud_storage_path:a})),f.Am.success("Image uploaded successfully")}catch(e){console.error("Error uploading image:",e),f.Am.error("Failed to upload image")}finally{E(!1)}},L=async r=>{if(r.preventDefault(),!t){f.Am.error("Please select a store first");return}S(!0);try{let r=await fetch("/api/products",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...A,storeId:t.id})});if(r.ok)f.Am.success("Product created successfully"),e.push("/products");else{let e=await r.json();f.Am.error(e?.error||"Failed to create product")}}catch(e){console.error("Error creating product:",e),f.Am.error("Error creating product")}finally{S(!1)}};return(0,a.jsx)(o.I,{children:(0,a.jsxs)(s.p,{allowedRoles:["ADMIN"],children:[(0,a.jsx)(f.x7,{position:"top-right"}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(l.W,{}),(0,a.jsxs)("main",{className:"mx-auto max-w-3xl px-4 py-8 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)(h.default,{href:"/products",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Back to Products"})]})}),(0,a.jsxs)("div",{className:"rounded-xl bg-white p-8 shadow-sm",children:[(0,a.jsx)("h1",{className:"mb-6 text-2xl font-bold text-gray-900",children:"Add New Product"}),(0,a.jsxs)("form",{onSubmit:L,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"barcode",className:"block text-sm font-medium text-gray-700",children:"Barcode (Auto-generated)"}),(0,a.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,a.jsx)("input",{id:"barcode",type:"text",required:!0,value:A.barcode,readOnly:!0,className:"block w-full rounded-lg border border-gray-300 bg-gray-50 px-3 py-2 text-gray-700"}),(0,a.jsx)("button",{type:"button",onClick:()=>{let e=(0,x.S1)();F(r=>({...r,barcode:e})),f.Am.success("New barcode generated")},className:"rounded-lg bg-gray-100 p-2 text-gray-600 hover:bg-gray-200",title:"Generate new barcode",children:(0,a.jsx)(c.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{A.barcode&&(0,x.Ol)(A.barcode,A.name||"New Product",parseFloat(A.price)||void 0,r.symbol)},className:"rounded-lg bg-emerald-100 p-2 text-emerald-600 hover:bg-emerald-200",title:"Print barcode",children:(0,a.jsx)(u.Z,{className:"h-5 w-5"})}),(0,a.jsx)("button",{type:"button",onClick:()=>{A.barcode&&((0,x.E_)(A.barcode,A.name||"new-product"),f.Am.success("Barcode downloaded"))},className:"rounded-lg bg-blue-100 p-2 text-blue-600 hover:bg-blue-200",title:"Download barcode",children:(0,a.jsx)(m.Z,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"mt-3 flex justify-center rounded-lg border border-gray-200 bg-white p-4",children:(0,a.jsx)("svg",{id:"barcode-preview",ref:P})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Product Name *"}),(0,a.jsx)("input",{id:"name",type:"text",required:!0,value:A.name,onChange:e=>F({...A,name:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"Description"}),(0,a.jsx)("textarea",{id:"description",rows:3,value:A.description,onChange:e=>F({...A,description:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,a.jsxs)("div",{className:"grid gap-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700",children:"Category *"}),(0,a.jsxs)("select",{id:"category",required:!0,value:A.categoryId,onChange:e=>F({...A,categoryId:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[(0,a.jsx)("option",{value:"",children:"Select Category"}),j?.map?.(e=>a.jsx("option",{value:e?.id,children:e?.name},e?.id))??null]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price *"}),(0,a.jsx)("input",{id:"price",type:"number",step:"0.01",min:"0",required:!0,value:A.price,onChange:e=>F({...A,price:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 sm:grid-cols-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"stock",className:"block text-sm font-medium text-gray-700",children:"Stock Quantity *"}),(0,a.jsx)("input",{id:"stock",type:"number",min:"0",required:!0,value:A.stock,onChange:e=>F({...A,stock:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"reorderLevel",className:"block text-sm font-medium text-gray-700",children:"Reorder Level"}),(0,a.jsx)("input",{id:"reorderLevel",type:"number",min:"0",value:A.reorderLevel,onChange:e=>F({...A,reorderLevel:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"supplier",className:"block text-sm font-medium text-gray-700",children:"Supplier"}),(0,a.jsxs)("select",{id:"supplier",value:A.supplierId,onChange:e=>F({...A,supplierId:e.target.value}),className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[(0,a.jsx)("option",{value:"",children:"Select Supplier (Optional)"}),w?.map?.(e=>a.jsx("option",{value:e?.id,children:e?.name},e?.id))??null]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"image",className:"block text-sm font-medium text-gray-700",children:"Product Image"}),(0,a.jsxs)("div",{className:"mt-1 flex items-center space-x-4",children:[(0,a.jsxs)("label",{className:"flex cursor-pointer items-center space-x-2 rounded-lg border-2 border-dashed border-gray-300 px-4 py-2 hover:border-emerald-500",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:C?"Uploading...":"Choose File"}),(0,a.jsx)("input",{id:"image",type:"file",accept:"image/*",onChange:_,disabled:C,className:"hidden"})]}),A.imageUrl&&(0,a.jsx)("span",{className:"text-sm text-green-600",children:"Image uploaded"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 border-t border-gray-200 pt-6",children:[(0,a.jsx)(h.default,{href:"/products",className:"rounded-lg bg-gray-200 px-6 py-2 font-medium text-gray-700 hover:bg-gray-300",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:k||C,className:"flex items-center space-x-2 rounded-lg bg-emerald-600 px-6 py-2 font-medium text-white hover:bg-emerald-700 disabled:opacity-50",children:k?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.Z,{className:"h-5 w-5 animate-spin"}),(0,a.jsx)("span",{children:"Creating..."})]}):(0,a.jsx)("span",{children:"Create Product"})})]})]})]})]})]})]})})}},11117:function(e,r,t){"use strict";t.d(r,{p:function(){return n}});var a=t(15444),o=t(75762),s=t(79047),l=t(89300);function n({children:e,allowedRoles:r,fallbackUrl:t="/dashboard"}){let{data:n,status:i}=(0,o.useSession)()||{},d=(0,s.useRouter)();if((0,l.useEffect)(()=>{if("authenticated"===i&&n?.user){let e=n.user?.role;r?.includes?.(e)||d.replace(t)}},[i,n,r,t,d]),"loading"===i)return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-emerald-600"})});if("authenticated"===i){let t=n?.user?.role;if(r?.includes?.(t))return(0,a.jsx)(a.Fragment,{children:e})}return null}},14757:function(e,r,t){"use strict";t.d(r,{AI:function(){return l},E_:function(){return i},Ol:function(){return n},S1:function(){return s}});var a=t(85608),o=t.n(a);function s(){let e=Date.now().toString().slice(-10)+Math.floor(100*Math.random()).toString().padStart(2,"0"),r=function(e){let r=0;for(let t=0;t<12;t++){let a=parseInt(e[t],10);r+=t%2==0?a:3*a}return((10-r%10)%10).toString()}(e);return e+r}function l(e,r){try{o()(`#${r}`,e,{format:"EAN13",width:2,height:80,displayValue:!0,fontSize:14,margin:10})}catch(e){console.error("Error generating barcode:",e)}}function n(e,r,t,a){let o=window.open("","_blank","width=400,height=300");if(!o){alert("Please allow pop-ups to print barcode");return}let s=t?`${a||"KSh"} ${t.toFixed(2)}`:"";o.document.write(`
    <!DOCTYPE html>
    <html>
      <head>
        <title>Print Barcode - ${r}</title>
        <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
        <style>
          @page {
            size: 60mm 40mm;
            margin: 0;
          }
          body {
            margin: 0;
            padding: 5mm;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
          }
          .label {
            text-align: center;
            width: 50mm;
          }
          .product-name {
            font-size: 10px;
            font-weight: bold;
            margin-bottom: 2mm;
            max-width: 50mm;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
          }
          .price {
            font-size: 12px;
            font-weight: bold;
            margin-top: 2mm;
          }
          svg {
            max-width: 50mm;
          }
        </style>
      </head>
      <body>
        <div class="label">
          <div class="product-name">${r}</div>
          <svg id="barcode"></svg>
          ${s?`<div class="price">${s}</div>`:""}
        </div>
        <script>
          JsBarcode("#barcode", "${e}", {
            format: "EAN13",
            width: 1.5,
            height: 50,
            displayValue: true,
            fontSize: 12,
            margin: 5
          });
          window.onload = () => {
            setTimeout(() => {
              window.print();
              window.close();
            }, 300);
          };
        </script>
      </body>
    </html>
  `),o.document.close()}function i(e,r){let t=document.createElement("canvas");o()(t,e,{format:"EAN13",width:2,height:80,displayValue:!0,fontSize:14,margin:10});let a=document.createElement("a");a.download=`barcode-${r.replace(/\s+/g,"-").toLowerCase()}.png`,a.href=t.toDataURL("image/png"),a.click()}},98155:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(42154).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},26584:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(42154).Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]])},1946:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(42154).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},4805:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(42154).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])}},function(e){e.O(0,[676,258,535,628,608,386,156,744],function(){return e(e.s=77838)}),_N_E=e.O()}]);