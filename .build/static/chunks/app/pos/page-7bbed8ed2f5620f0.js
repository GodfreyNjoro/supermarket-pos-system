(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[664],{71426:function(e,t,s){Promise.resolve().then(s.bind(s,97796))},97796:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return O}});var a=s(15444),r=s(46271),l=s(3763),i=s(95777),n=s(89300),o=s(4460),d=s(33485),c=s(79582),m=s(62492),u=s(25076),x=s(98699),h=s(80595),g=s(4693),p=s(54907),b=s(40563),y=s(99211),f=s(39429),j=s(97927),N=s(1946),v=s(43691),w=s(92690),S=s(21284);function C({onScan:e}){let[t,s]=(0,n.useState)(!1),[r,l]=(0,n.useState)(""),[i,o]=(0,n.useState)(""),[c,m]=(0,n.useState)(!1),u=(0,n.useRef)(null),x=(0,n.useRef)(null),h=(0,n.useRef)(null),g=(0,n.useRef)(!1),p=async()=>{try{if(l(""),m(!0),console.log("Starting camera..."),!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw Error("Camera API not supported in this browser");if(s(!0),await new Promise(e=>setTimeout(e,100)),!u.current&&(await new Promise(e=>setTimeout(e,200)),!u.current))throw Error("Video element failed to render");console.log("Video element ready, requesting camera...");let e=await Promise.race([navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}}),new Promise((e,t)=>setTimeout(()=>t(Error("Camera access timeout")),1e4))]);console.log("Camera stream obtained:",e),u.current.srcObject=e,x.current=e,await Promise.race([new Promise(e=>{u.current&&(u.current.readyState>=2?(console.log("Video already ready"),e()):u.current.onloadedmetadata=()=>{console.log("Video metadata loaded"),e()})}),new Promise((e,t)=>setTimeout(()=>t(Error("Video loading timeout")),5e3))]),console.log("Video ready, starting scanner...");let t=new Map,a=[S.BarcodeFormat.EAN_13,S.BarcodeFormat.EAN_8,S.BarcodeFormat.UPC_A,S.BarcodeFormat.UPC_E,S.BarcodeFormat.UPC_EAN_EXTENSION,S.BarcodeFormat.CODE_128,S.BarcodeFormat.CODE_39,S.BarcodeFormat.CODE_93,S.BarcodeFormat.CODABAR,S.BarcodeFormat.ITF,S.BarcodeFormat.QR_CODE,S.BarcodeFormat.DATA_MATRIX,S.BarcodeFormat.AZTEC,S.BarcodeFormat.PDF_417];t.set(S.DecodeHintType.POSSIBLE_FORMATS,a),t.set(S.DecodeHintType.TRY_HARDER,!0),h.current=new S.BrowserMultiFormatReader(t),console.log("✅ Scanner configured with support for:",a.length,"barcode formats"),m(!1),g.current=!0,b(),console.log("Scanner started successfully")}catch(t){console.error("Camera error:",t),x.current&&(x.current.getTracks().forEach(e=>e.stop()),x.current=null);let e="Camera access denied or not available";"NotAllowedError"===t.name?e="Camera permission denied. Please allow camera access in your browser settings.":"NotFoundError"===t.name?e="No camera found on this device.":"NotReadableError"===t.name?e="Camera is already in use by another application.":t.message&&(e=t.message),l(e),m(!1),s(!1)}},b=async()=>{if(g.current&&u.current&&h.current)try{let t=await h.current.decodeFromVideoElement(u.current);if(t){let s=t.getText();console.log("Barcode detected:",s),o(s),g.current=!1,setTimeout(()=>{e(s),y()},500)}}catch(e){e instanceof S.NotFoundException||console.error("Scan error:",e),g.current&&requestAnimationFrame(()=>b())}},y=()=>{g.current=!1,x.current&&(x.current.getTracks().forEach(e=>e.stop()),x.current=null),h.current&&(h.current.reset(),h.current=null),s(!1),o(""),m(!1)};return((0,n.useEffect)(()=>()=>{y()},[]),t)?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90",children:(0,a.jsxs)("div",{className:"relative w-full max-w-2xl mx-4",children:[(0,a.jsx)("button",{onClick:y,className:"absolute right-4 top-4 z-10 rounded-full bg-white/90 p-2 hover:bg-white shadow-lg transition-colors",children:(0,a.jsx)(d.Z,{className:"h-6 w-6 text-gray-700"})}),(0,a.jsxs)("div",{className:"bg-white rounded-lg overflow-hidden shadow-2xl",children:[(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-white",children:"Automatic Barcode Scanner"}),(0,a.jsx)("p",{className:"text-blue-100 text-sm mt-1",children:"Point camera at barcode to scan automatically"})]}),r&&(0,a.jsx)("div",{className:"mx-4 mt-4 rounded-lg bg-red-50 border border-red-200 p-3 text-sm text-red-700",children:r}),(0,a.jsxs)("div",{className:"relative aspect-video bg-black",children:[(0,a.jsx)("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"w-64 h-64 border-4 border-blue-500 rounded-lg relative",children:[(0,a.jsx)("div",{className:"absolute -top-1 -left-1 w-8 h-8 border-t-4 border-l-4 border-white rounded-tl-lg"}),(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-8 h-8 border-t-4 border-r-4 border-white rounded-tr-lg"}),(0,a.jsx)("div",{className:"absolute -bottom-1 -left-1 w-8 h-8 border-b-4 border-l-4 border-white rounded-bl-lg"}),(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 border-b-4 border-r-4 border-white rounded-br-lg"}),!i&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-full h-1 bg-gradient-to-r from-transparent via-blue-400 to-transparent animate-pulse"})}),i&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-green-500/20",children:(0,a.jsx)("div",{className:"bg-green-500 rounded-full p-3",children:(0,a.jsx)(w.Z,{className:"h-12 w-12 text-white"})})})]}),!i&&(0,a.jsx)("div",{className:"absolute -bottom-16 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:(0,a.jsx)("div",{className:"bg-black/70 text-white px-4 py-2 rounded-full text-sm font-medium",children:"Position barcode in the frame"})}),i&&(0,a.jsx)("div",{className:"absolute -bottom-16 left-1/2 transform -translate-x-1/2 whitespace-nowrap",children:(0,a.jsxs)("div",{className:"bg-green-500 text-white px-6 py-3 rounded-full text-base font-bold shadow-lg",children:["✓ ",i]})})]})})]}),(0,a.jsx)("div",{className:"p-4 bg-gray-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{children:"Scanning active..."})]}),(0,a.jsx)("button",{onClick:y,className:"text-blue-600 hover:text-blue-700 font-medium",children:"Cancel Scanning"})]})})]})]})}):(0,a.jsx)("button",{onClick:p,disabled:c,className:"flex items-center space-x-2 rounded-lg bg-blue-600 px-4 py-2 font-medium text-white transition-colors hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed",children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.Z,{className:"h-5 w-5 animate-spin"}),(0,a.jsx)("span",{children:"Opening Camera..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Scan Barcode"})]})})}var k=s(85011),P=s(26584),E=s(5903),F=s(32235),T=s(26317);class I{static{this.RECEIPT_WIDTH=72}static{this.FONT_SIZE=8}static{this.LINE_HEIGHT=4}static{this.MARGIN=3}static generatePDF(e){let t=e.items.length*this.LINE_HEIGHT,s=new T.ZP({orientation:"portrait",unit:"mm",format:[this.RECEIPT_WIDTH,Math.max(100+t,150)]}),a=this.RECEIPT_WIDTH/2,r=this.RECEIPT_WIDTH-this.MARGIN,l=8;s.setFontSize(12),s.setFont("helvetica","bold"),s.text(e.storeName||"SuperPOS",a,l,{align:"center"}),l+=5,s.setFontSize(7),s.setFont("helvetica","normal"),e.storeAddress&&(s.text(e.storeAddress,a,l,{align:"center"}),l+=3),e.storePhone&&(s.text(`Tel: ${e.storePhone}`,a,l,{align:"center"}),l+=3),l+=1,s.setLineWidth(.2),s.line(this.MARGIN,l,r,l),l+=4,s.setFontSize(this.FONT_SIZE),s.text(`Receipt: ${e.saleId.slice(-12)}`,this.MARGIN,l),l+=this.LINE_HEIGHT,s.text(`Date: ${e.date.toLocaleDateString()} ${e.date.toLocaleTimeString()}`,this.MARGIN,l),l+=this.LINE_HEIGHT,s.text(`Cashier: ${e.cashier}`,this.MARGIN,l),l+=this.LINE_HEIGHT,e.customer&&(s.text(`Customer: ${e.customer.name}`,this.MARGIN,l),l+=this.LINE_HEIGHT),l+=1,s.line(this.MARGIN,l,r,l),l+=3,s.setFont("helvetica","bold"),s.setFontSize(7),s.text("Item",this.MARGIN,l),s.text("Qty",38,l,{align:"center"}),s.text("Price",50,l,{align:"center"}),s.text("Total",r,l,{align:"right"}),l+=3,s.line(this.MARGIN,l,r,l),l+=3;let i=e.currencySymbol||"KSh";return s.setFont("helvetica","normal"),e.items.forEach(e=>{let t=e.name.length>18?e.name.substring(0,16)+"..":e.name;s.text(t,this.MARGIN,l),s.text(e.quantity.toString(),38,l,{align:"center"}),s.text(`${i} ${e.price.toFixed(2)}`,50,l,{align:"center"}),s.text(`${i} ${e.total.toFixed(2)}`,r,l,{align:"right"}),l+=this.LINE_HEIGHT}),l+=1,s.line(this.MARGIN,l,r,l),l+=4,s.text("Subtotal:",35,l),s.text(`${i} ${e.subtotal.toFixed(2)}`,r,l,{align:"right"}),l+=this.LINE_HEIGHT,e.discount>0&&(s.text("Discount:",35,l),s.text(`-${i} ${e.discount.toFixed(2)}`,r,l,{align:"right"}),l+=this.LINE_HEIGHT),s.text("Tax:",35,l),s.text(`${i} ${e.tax.toFixed(2)}`,r,l,{align:"right"}),l+=this.LINE_HEIGHT,s.setLineWidth(.3),s.line(33,l,r,l),l+=4,s.setFont("helvetica","bold"),s.setFontSize(10),s.text("TOTAL:",35,l),s.text(`${i} ${e.total.toFixed(2)}`,r,l,{align:"right"}),l+=5,s.setFont("helvetica","normal"),s.setFontSize(this.FONT_SIZE),s.text(`Paid (${e.paymentMethod}):`,35,l),s.text(`${i} ${e.amountPaid.toFixed(2)}`,r,l,{align:"right"}),l+=this.LINE_HEIGHT,e.change>0&&(s.text("Change:",35,l),s.text(`${i} ${e.change.toFixed(2)}`,r,l,{align:"right"}),l+=this.LINE_HEIGHT),l+=4,s.setLineWidth(.2),s.line(this.MARGIN,l,r,l),l+=4,s.setFontSize(8),s.text("Thank you for shopping!",a,l,{align:"center"}),l+=3,s.setFontSize(7),s.text("Please come again",a,l,{align:"center"}),s}static downloadPDF(e,t){let s=this.generatePDF(e),a=t||`receipt-${e.saleId}.pdf`;s.save(a)}static printReceipt(e){let t=this.generatePDF(e).output("dataurlstring"),s=window.open("","_blank");s?(s.document.write(`
        <html>
          <head>
            <title>Print Receipt - ${e.saleId}</title>
            <style>
              body { margin: 0; }
              iframe { border: none; width: 100%; height: 100vh; }
            </style>
          </head>
          <body>
            <iframe src="${t}"></iframe>
            <script>
              window.onload = () => {
                setTimeout(() => {
                  window.print();
                }, 500);
              };
            </script>
          </body>
        </html>
      `),s.document.close()):alert("Please allow pop-ups to print receipt")}static generateHTML(e){return`
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="utf-8">
          <style>
            body {
              font-family: 'Courier New', monospace;
              max-width: 400px;
              margin: 20px auto;
              padding: 20px;
              border: 1px solid #ddd;
            }
            .header {
              text-align: center;
              margin-bottom: 20px;
            }
            .header h1 {
              margin: 0;
              font-size: 18px;
            }
            .header p {
              margin: 5px 0;
              font-size: 12px;
            }
            .divider {
              border-top: 1px dashed #333;
              margin: 15px 0;
            }
            .info {
              font-size: 12px;
              margin-bottom: 10px;
            }
            table {
              width: 100%;
              font-size: 12px;
              border-collapse: collapse;
            }
            th {
              text-align: left;
              border-bottom: 1px solid #333;
              padding-bottom: 5px;
            }
            td {
              padding: 5px 0;
            }
            .text-right {
              text-align: right;
            }
            .totals {
              margin-top: 15px;
              border-top: 1px solid #333;
              padding-top: 10px;
            }
            .totals table {
              width: 100%;
            }
            .totals td {
              padding: 3px 0;
            }
            .total-row {
              font-weight: bold;
              font-size: 14px;
              border-top: 2px solid #333;
              padding-top: 10px !important;
            }
            .footer {
              text-align: center;
              margin-top: 20px;
              font-size: 12px;
            }
          </style>
        </head>
        <body>
          <div class="header">
            <h1>${e.storeName||"Supermarket POS"}</h1>
            ${e.storeAddress?`<p>${e.storeAddress}</p>`:""}
            ${e.storePhone?`<p>${e.storePhone}</p>`:""}
          </div>

          <div class="divider"></div>

          <div class="info">
            <p><strong>Receipt #:</strong> ${e.saleId}</p>
            <p><strong>Date:</strong> ${e.date.toLocaleString()}</p>
            <p><strong>Cashier:</strong> ${e.cashier}</p>
            ${e.customer?`<p><strong>Customer:</strong> ${e.customer.name}</p>`:""}
          </div>

          <div class="divider"></div>

          <table>
            <thead>
              <tr>
                <th>Item</th>
                <th class="text-right">Qty</th>
                <th class="text-right">Price</th>
                <th class="text-right">Total</th>
              </tr>
            </thead>
            <tbody>
              ${e.items.map(t=>`
                <tr>
                  <td>${t.name}</td>
                  <td class="text-right">${t.quantity}</td>
                  <td class="text-right">${e.currencySymbol||"KSh"} ${t.price.toFixed(2)}</td>
                  <td class="text-right">${e.currencySymbol||"KSh"} ${t.total.toFixed(2)}</td>
                </tr>
              `).join("")}
            </tbody>
          </table>

          <div class="totals">
            <table>
              <tr>
                <td>Subtotal:</td>
                <td class="text-right">${e.currencySymbol||"KSh"} ${e.subtotal.toFixed(2)}</td>
              </tr>
              ${e.discount>0?`
              <tr>
                <td>Discount:</td>
                <td class="text-right">-${e.currencySymbol||"KSh"} ${e.discount.toFixed(2)}</td>
              </tr>
              `:""}
              <tr>
                <td>Tax:</td>
                <td class="text-right">${e.currencySymbol||"KSh"} ${e.tax.toFixed(2)}</td>
              </tr>
              <tr class="total-row">
                <td><strong>TOTAL:</strong></td>
                <td class="text-right"><strong>${e.currencySymbol||"KSh"} ${e.total.toFixed(2)}</strong></td>
              </tr>
              <tr>
                <td>Payment (${e.paymentMethod}):</td>
                <td class="text-right">${e.currencySymbol||"KSh"} ${e.amountPaid.toFixed(2)}</td>
              </tr>
              ${e.change>0?`
              <tr>
                <td>Change:</td>
                <td class="text-right">${e.currencySymbol||"KSh"} ${e.change.toFixed(2)}</td>
              </tr>
              `:""}
            </table>
          </div>

          <div class="divider"></div>

          <div class="footer">
            <p><strong>Thank you for your business!</strong></p>
            <p>Please come again</p>
          </div>
        </body>
      </html>
    `}}var A=s(75762),$=s(3857);function R({total:e,subtotal:t,discount:s,cartItems:r,customer:l,onClose:i,onPayment:o,saleCompleted:c=!1,saleData:m=null}){let{data:u}=(0,A.useSession)()||{},{formatPrice:x,currency:h}=(0,$.U8)(),[g,p]=(0,n.useState)("CASH"),[b,y]=(0,n.useState)(e?.toString?.()??"0"),[f,j]=(0,n.useState)(!1),[v,w]=(0,n.useState)(!0),S=[Math.ceil(e),5*Math.ceil(e/5),10*Math.ceil(e/10),20*Math.ceil(e/20)].filter((t,s,a)=>a.indexOf(t)===s&&t>=e).slice(0,4),C=()=>Math.max(0,(parseFloat(b)||0)-e),T=async t=>{t.preventDefault();let s=parseFloat(b)||0;if(s<e){alert("Amount paid is less than total");return}j(!0);let a="CASH"===g?C():0;await new Promise(e=>setTimeout(e,500)),o(g,s,a)},R=()=>{let a=m||{id:`TEMP-${Date.now()}`,createdAt:new Date,cashier:u?.user?.name||"Cashier",customer:l,items:r,subtotal:t,discount:s,total:e,paymentMethod:g,amountPaid:parseFloat(b),changeGiven:C()};return{saleId:a.id,date:new Date(a.createdAt),cashier:a.cashier,customer:a.customer?{name:a.customer.name,email:a.customer.email}:void 0,items:r.map(e=>({name:e.product.name,quantity:e.quantity,price:e.product.price,total:e.subtotal})),subtotal:a.subtotal,discount:a.discount||s,tax:.1*t,total:a.total,paymentMethod:a.paymentMethod,amountPaid:a.amountPaid,change:a.changeGiven||0,storeName:"Supermarket POS",storeAddress:"123 Main Street, City, State",storePhone:"+1 (555) 123-4567",currencySymbol:h.symbol}};return c&&m?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-xl bg-white p-6 shadow-xl",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-emerald-600",children:"Payment Successful!"}),(0,a.jsx)("button",{onClick:i,className:"rounded-full p-2 hover:bg-gray-100",children:(0,a.jsx)(d.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-lg bg-emerald-50 p-4 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-emerald-700",children:"Transaction Complete"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-emerald-700",children:x(m.total??0)}),(0,a.jsxs)("p",{className:"mt-2 text-xs text-emerald-600",children:["Receipt #",m.id]})]}),m.changeGiven>0&&(0,a.jsxs)("div",{className:"rounded-lg bg-blue-50 p-4 text-center",children:[(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"Change Given"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-700",children:x(m.changeGiven??0)})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>{let e=R();I.printReceipt(e)},className:"flex w-full items-center justify-center space-x-2 rounded-lg bg-emerald-600 px-4 py-3 font-medium text-white hover:bg-emerald-700",children:[(0,a.jsx)(k.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Print Receipt"})]}),(0,a.jsxs)("button",{onClick:()=>{let e=R();I.downloadPDF(e)},className:"flex w-full items-center justify-center space-x-2 rounded-lg border-2 border-emerald-600 bg-white px-4 py-3 font-medium text-emerald-600 hover:bg-emerald-50",children:[(0,a.jsx)(P.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Download PDF"})]}),(0,a.jsx)("button",{onClick:i,className:"w-full rounded-lg bg-gray-200 px-4 py-3 font-medium text-gray-700 hover:bg-gray-300",children:"Close"})]})]})}):(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-xl bg-white p-6 shadow-xl",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Payment"}),(0,a.jsx)("button",{onClick:i,className:"rounded-full p-2 hover:bg-gray-100",children:(0,a.jsx)(d.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Payment Method"}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-2 gap-3",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>{p("CASH"),y(e?.toString?.()??"0")},className:`flex flex-col items-center space-y-2 rounded-lg border-2 p-4 transition-all ${"CASH"===g?"border-emerald-600 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,children:[(0,a.jsx)(E.Z,{className:`h-8 w-8 ${"CASH"===g?"text-emerald-600":"text-gray-400"}`}),(0,a.jsx)("span",{className:"font-medium",children:"Cash"})]}),(0,a.jsxs)("button",{type:"button",onClick:()=>{p("CARD"),y(e?.toString?.()??"0")},className:`flex flex-col items-center space-y-2 rounded-lg border-2 p-4 transition-all ${"CARD"===g?"border-emerald-600 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,children:[(0,a.jsx)(F.Z,{className:`h-8 w-8 ${"CARD"===g?"text-emerald-600":"text-gray-400"}`}),(0,a.jsx)("span",{className:"font-medium",children:"Card"})]})]})]}),(0,a.jsx)("div",{className:"rounded-lg bg-gray-50 p-4",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,a.jsx)("span",{className:"font-bold text-gray-900",children:x(e??0)})]})}),"CASH"===g&&(0,a.jsxs)(a.Fragment,{children:[S.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quick Amounts"}),(0,a.jsx)("div",{className:"grid grid-cols-4 gap-2",children:S.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>y(e.toString()),className:"rounded-lg border-2 border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-700 hover:border-emerald-500 hover:bg-emerald-50 hover:text-emerald-700",children:x(e)},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"amountPaid",className:"block text-sm font-medium text-gray-700",children:"Amount Paid"}),(0,a.jsx)("input",{id:"amountPaid",type:"number",step:"0.01",min:e,value:b,onChange:e=>y(e.target.value),required:!0,className:"mt-1 block w-full rounded-lg border border-gray-300 px-3 py-2 text-lg font-semibold text-gray-900 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500"})]}),(0,a.jsx)("div",{className:"rounded-lg bg-emerald-50 p-4",children:(0,a.jsxs)("div",{className:"flex justify-between text-lg",children:[(0,a.jsx)("span",{className:"text-emerald-700",children:"Change:"}),(0,a.jsx)("span",{className:"font-bold text-emerald-700",children:x(C()??0)})]})})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{type:"button",onClick:i,className:"flex-1 rounded-lg bg-gray-200 px-4 py-2 font-medium text-gray-700 hover:bg-gray-300",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:f,className:"flex flex-1 items-center justify-center space-x-2 rounded-lg bg-emerald-600 px-4 py-2 font-medium text-white hover:bg-emerald-700 disabled:opacity-50",children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(N.Z,{className:"h-5 w-5 animate-spin"}),(0,a.jsx)("span",{children:"Processing..."})]}):(0,a.jsx)("span",{children:"Complete Payment"})})]})]})]})})}var D=s(32226),_=s(34669),H=s(95854),M=s(82534);function O(){let{data:e}=(0,A.useSession)()||{},{isOnline:t}=(0,D.k)(),{selectedStore:s}=(0,M.o)(),{formatPrice:N}=(0,$.U8)(),[v,w]=(0,n.useState)(""),[S,k]=(0,n.useState)(""),[P,E]=(0,n.useState)([]),[F,T]=(0,n.useState)([]),[I,O]=(0,n.useState)([]),[G,Z]=(0,n.useState)([]),[L,B]=(0,n.useState)(null),[q,K]=(0,n.useState)("PERCENTAGE"),[z,U]=(0,n.useState)(0),[W,V]=(0,n.useState)(!1),[Q,J]=(0,n.useState)(null),[X,Y]=(0,n.useState)(!1),ee=(0,n.useRef)(null),[et,es]=(0,n.useState)(""),[ea,er]=(0,n.useState)("name"),[el,ei]=(0,n.useState)("asc"),[en,eo]=(0,n.useState)(!1),[ed,ec]=(0,n.useState)([]),[em,eu]=(0,n.useState)(!0),[ex,eh]=(0,n.useState)([]),[eg,ep]=(0,n.useState)([]),[eb,ey]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=localStorage.getItem("pos_favorites"),t=localStorage.getItem("pos_recent");e&&eh(JSON.parse(e)),t&&ep(JSON.parse(t))},[]),(0,n.useEffect)(()=>{s&&(ef(),ej(),eN())},[t,s]),(0,n.useEffect)(()=>{let e=[...I];S&&(e=e.filter(e=>e.name?.toLowerCase().includes(S.toLowerCase())||e.barcode?.includes(S))),et&&(e=e.filter(e=>e.categoryId===et)),e.sort((e,t)=>{let s=0;return"name"===ea?s=e.name.localeCompare(t.name):"price"===ea?s=e.price-t.price:"stock"===ea&&(s=e.stock-t.stock),"asc"===el?s:-s}),T(e)},[S,et,ea,el,I]);let ef=async(e="")=>{try{if(!s)return;if(t){let e=`/api/products?storeId=${s.id}`,t=await fetch(e),a=await t.json();O(a),T(a)}else{let e=(await _.N.getCachedProducts()).filter(e=>e.storeId===s.id);O(e),T(e)}}catch(e){(0,H.Am)({title:"Error",description:"Failed to load products",variant:"destructive"})}},ej=async()=>{try{if(t){let e=await fetch("/api/customers"),t=await e.json();Z(t)}else{let e=await _.N.getCachedCustomers();Z(e)}}catch(e){}},eN=async()=>{try{if(t){let e=await fetch("/api/categories"),t=await e.json();ec(t)}else{let e=await _.N.getCachedCategories();ec(e)}}catch(e){}};!function(e,t=!0){let s=(0,n.useCallback)(s=>{if(!t)return;let a=s.target;if("INPUT"!==a.tagName&&"TEXTAREA"!==a.tagName&&!a.isContentEditable)for(let t of e){let e=s.key.toLowerCase()===t.key.toLowerCase(),a=t.ctrl?s.ctrlKey||s.metaKey:!s.ctrlKey&&!s.metaKey,r=t.alt?s.altKey:!s.altKey,l=t.shift?s.shiftKey:!s.shiftKey;if(e&&a&&r&&l){s.preventDefault(),t.handler();break}}},[e,t]);(0,n.useEffect)(()=>{if(t)return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[s,t])}([{key:"F1",description:"Focus barcode scanner",handler:()=>ee.current?.focus()},{key:"F2",description:"Open payment modal",handler:()=>P.length>0&&V(!0)},{key:"F3",description:"Clear cart",handler:()=>P.length>0&&eS()},{key:"F4",description:"Toggle filters",handler:()=>eo(!en)},{key:"F5",description:"Toggle quick templates",handler:()=>eu(!em)},{key:"Escape",description:"Close modals",handler:()=>{V(!1),ey(!1),eo(!1)}},{key:"?",shift:!0,description:"Show keyboard shortcuts",handler:()=>ey(!0)}]);let ev=e=>{let t=ex.includes(e)?ex.filter(t=>t!==e):[...ex,e];eh(t),localStorage.setItem("pos_favorites",JSON.stringify(t)),(0,H.Am)({title:ex.includes(e)?"Removed from favorites":"Added to favorites",duration:2e3})},ew=e=>{let t=[e,...eg.filter(t=>t!==e)].slice(0,10);ep(t),localStorage.setItem("pos_recent",JSON.stringify(t))},eS=()=>{confirm("Are you sure you want to clear the cart?")&&(E([]),U(0))},eC=async e=>{if(e.preventDefault(),!v?.trim?.())return;let t=v?.trim?.(),s=F?.find?.(e=>e?.barcode===t);s?(ek(s),w(""),ee?.current?.focus?.()):alert("Product not found")},ek=e=>{if(e?.stock<=0){alert("Product out of stock");return}ew(e.id);let t=P?.find?.(t=>t?.product?.id===e?.id);if(t){if(t?.quantity>=e?.stock){alert("Cannot add more than available stock");return}eP(e?.id,t?.quantity+1)}else E([...P,{product:e,quantity:1,discount:0,subtotal:e?.price}])},eP=(e,t)=>{if(t<=0){eE(e);return}E(P?.map?.(s=>{if(s?.product?.id===e){let e=Math.min(t,s?.product?.stock),a=s?.product?.price*e-(s?.discount||0);return{...s,quantity:e,subtotal:a}}return s})??[])},eE=e=>{E(P?.filter?.(t=>t?.product?.id!==e)??[])},eF=()=>P?.reduce?.((e,t)=>e+t?.subtotal,0)??0,eT=()=>{let e=eF();return"PERCENTAGE"===q?e*z/100:z},eI=()=>Math.max(0,eF()-eT()),eA=async(a,r,l)=>{try{if(!s){(0,H.Am)({title:"Error",description:"Please select a store first",variant:"destructive"});return}let i={customerId:L?.id||null,storeId:s.id,items:P?.map?.(e=>({productId:e?.product?.id,quantity:e?.quantity,unitPrice:e?.product?.price,discount:e?.discount,subtotal:e?.subtotal}))??[],subtotal:eF(),discountType:z>0?q:null,discountValue:z>0?z:0,discountAmount:eT(),total:eI(),paymentMethod:a,amountPaid:r,changeGiven:l};if(t){let e=await fetch("/api/sales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(e.ok){let t=await e.json();J(t),V(!1),Y(!0),(0,H.Am)({title:"Sale Complete",description:"Transaction processed successfully"}),E([]),B(null),U(0)}else alert("Failed to process sale")}else{let t={id:`offline-sale-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),type:"sale",data:i,synced:!1};await _.N.addTransaction(t);let s={id:t.id,...i,createdAt:new Date().toISOString(),user:e?.user};J(s),V(!1),Y(!0),(0,H.Am)({title:"Sale Queued (Offline)",description:"Transaction saved locally and will sync when online"}),E([]),B(null),U(0)}}catch(e){console.error("Error processing sale:",e),(0,H.Am)({title:"Error",description:"Failed to process sale",variant:"destructive"})}};return(0,a.jsxs)(r.I,{children:[(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(l.W,{}),(0,a.jsx)(i.FE,{children:(0,a.jsxs)("div",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Point of Sale"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"Scan products and process transactions"})]}),!t&&(0,a.jsx)("div",{className:"mb-6 rounded-lg bg-amber-50 border border-amber-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 text-amber-600 mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-amber-800",children:"Offline Mode"}),(0,a.jsx)("p",{className:"text-sm text-amber-700 mt-1",children:"You're working offline. Sales will be processed using cached data and synced when you're back online."})]})]})}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,a.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,a.jsx)("h2",{className:"mb-4 text-lg font-semibold text-gray-900",children:"Barcode Scanner"}),(0,a.jsxs)("form",{onSubmit:eC,className:"flex space-x-3 relative",children:[(0,a.jsxs)("div",{className:"flex-1 relative",children:[(0,a.jsx)("input",{ref:ee,type:"text",value:v,onChange:e=>w(e.target.value),placeholder:"Scan or enter barcode...",className:"w-full rounded-lg border border-gray-300 px-4 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",list:"barcode-suggestions",autoComplete:"off"}),(0,a.jsx)("datalist",{id:"barcode-suggestions",children:I.slice(0,10).map(e=>(0,a.jsxs)("option",{value:e.barcode,children:[e.name," - $",e.price]},e.id))})]}),(0,a.jsx)("button",{type:"submit",className:"rounded-lg bg-emerald-600 px-6 py-2 font-medium text-white hover:bg-emerald-700",children:"Add"}),(0,a.jsx)(C,{onScan:e=>{w(e),setTimeout(()=>{let t=F?.find?.(t=>t?.barcode===e);t?(ek(t),w("")):alert("Product not found")},100)}})]})]}),em&&(ex.length>0||eg.length>0)&&(0,a.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"Quick Access"}),(0,a.jsx)("button",{onClick:()=>eu(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[ex.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center space-x-2",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4 text-yellow-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Favorites"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:I.filter(e=>ex.includes(e.id)).slice(0,4).map(e=>(0,a.jsxs)("button",{onClick:()=>ek(e),className:"rounded-lg border border-gray-200 p-2 text-left text-sm hover:border-emerald-500 hover:bg-emerald-50",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.name}),(0,a.jsx)("div",{className:"text-emerald-600",children:N(e.price)})]},e.id))})]}),eg.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center space-x-2",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Recently Added"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:I.filter(e=>eg.includes(e.id)).slice(0,4).map(e=>(0,a.jsxs)("button",{onClick:()=>ek(e),className:"rounded-lg border border-gray-200 p-2 text-left text-sm hover:border-emerald-500 hover:bg-emerald-50",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.name}),(0,a.jsx)("div",{className:"text-emerald-600",children:N(e.price)})]},e.id))})]})]})]}),(0,a.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"mb-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-1 items-center space-x-3",children:[(0,a.jsx)(u.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsx)("input",{type:"text",value:S,onChange:e=>k(e.target.value),placeholder:"Search products...",className:"flex-1 border-0 p-0 focus:outline-none focus:ring-0"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:()=>eo(!en),className:`rounded-lg p-2 ${en?"bg-emerald-100 text-emerald-600":"text-gray-400 hover:bg-gray-100"}`,title:"Toggle Filters (F4)",children:(0,a.jsx)(x.Z,{className:"h-4 w-4"})}),(0,a.jsx)("button",{onClick:()=>ey(!0),className:"rounded-lg p-2 text-gray-400 hover:bg-gray-100",title:"Keyboard Shortcuts (?)",children:(0,a.jsx)(h.Z,{className:"h-4 w-4"})})]})]}),en&&(0,a.jsxs)("div",{className:"space-y-3 rounded-lg bg-gray-50 p-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Category"}),(0,a.jsxs)("select",{value:et,onChange:e=>es(e.target.value),className:"w-full rounded border-gray-300 text-sm",children:[(0,a.jsx)("option",{value:"",children:"All Categories"}),ed.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Sort By"}),(0,a.jsxs)("select",{value:`${ea}-${el}`,onChange:e=>{let[t,s]=e.target.value.split("-");er(t),ei(s)},className:"w-full rounded border-gray-300 text-sm",children:[(0,a.jsx)("option",{value:"name-asc",children:"Name (A-Z)"}),(0,a.jsx)("option",{value:"name-desc",children:"Name (Z-A)"}),(0,a.jsx)("option",{value:"price-asc",children:"Price (Low-High)"}),(0,a.jsx)("option",{value:"price-desc",children:"Price (High-Low)"}),(0,a.jsx)("option",{value:"stock-asc",children:"Stock (Low-High)"}),(0,a.jsx)("option",{value:"stock-desc",children:"Stock (High-Low)"})]})]})]}),(0,a.jsx)("button",{onClick:()=>{es(""),er("name"),ei("asc"),k("")},className:"text-xs text-emerald-600 hover:text-emerald-700",children:"Reset Filters"})]})]}),(0,a.jsx)("div",{className:"grid max-h-96 gap-3 overflow-y-auto sm:grid-cols-2",children:F?.slice?.(0,12)?.map?.(e=>a.jsxs("div",{className:"cursor-pointer rounded-lg border border-gray-200 p-4 transition-all hover:border-emerald-500 hover:shadow-md relative",children:[a.jsx("button",{onClick:t=>{t.stopPropagation(),ev(e.id)},className:"absolute top-2 right-2 p-1 rounded hover:bg-gray-100",children:a.jsx(c.Z,{className:`h-4 w-4 ${ex.includes(e.id)?"fill-yellow-500 text-yellow-500":"text-gray-400"}`})}),a.jsxs("div",{onClick:()=>ek(e),children:[a.jsx("h3",{className:"font-medium text-gray-900 pr-6",children:e?.name}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:e?.category?.name}),a.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[a.jsx("span",{className:"text-lg font-bold text-emerald-600",children:N(e?.price??0)}),a.jsxs("span",{className:"text-sm text-gray-500",children:["Stock: ",e?.stock??0]})]})]})]},e?.id))??null})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"mb-3 flex items-center space-x-2",children:[(0,a.jsx)(g.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:"Customer"})]}),(0,a.jsxs)("select",{value:L?.id||"",onChange:e=>{B(G?.find?.(t=>t?.id===e.target.value)||null)},className:"w-full rounded-lg border border-gray-300 px-3 py-2 focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[(0,a.jsx)("option",{value:"",children:"Walk-in Customer"}),G?.map?.(e=>a.jsxs("option",{value:e?.id,children:[e?.name," ",e?.phone?`(${e.phone})`:""]},e?.id))??null]})]}),(0,a.jsxs)("div",{className:"rounded-xl bg-white p-6 shadow-sm",children:[(0,a.jsxs)("div",{className:"mb-4 flex items-center space-x-2",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsxs)("h3",{className:"font-semibold text-gray-900",children:["Cart (",P?.length??0,")"]})]}),(0,a.jsx)("div",{className:"max-h-96 space-y-3 overflow-y-auto",children:P?.length>0?P?.map?.(e=>a.jsxs("div",{className:"rounded-lg bg-gray-50 p-3",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:e?.product?.name}),a.jsxs("p",{className:"text-sm text-gray-500",children:[N(e?.product?.price??0)," each"]})]}),a.jsx("button",{onClick:()=>eE(e?.product?.id),className:"text-red-500 hover:text-red-700",children:a.jsx(b.Z,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("button",{onClick:()=>eP(e?.product?.id,e?.quantity-1),className:"rounded-md bg-gray-200 p-1 hover:bg-gray-300",children:a.jsx(y.Z,{className:"h-4 w-4"})}),a.jsx("span",{className:"w-8 text-center font-medium",children:e?.quantity??0}),a.jsx("button",{onClick:()=>eP(e?.product?.id,e?.quantity+1),className:"rounded-md bg-gray-200 p-1 hover:bg-gray-300",children:a.jsx(f.Z,{className:"h-4 w-4"})})]}),a.jsx("span",{className:"font-semibold text-gray-900",children:N(e?.subtotal??0)})]})]},e?.product?.id))??null:(0,a.jsx)("p",{className:"py-8 text-center text-gray-500",children:"Cart is empty"})}),P?.length>0&&(0,a.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4",children:[(0,a.jsxs)("div",{className:"mb-2 flex items-center space-x-2",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Discount"})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("select",{value:q,onChange:e=>K(e.target.value),className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",children:[(0,a.jsx)("option",{value:"PERCENTAGE",children:"%"}),(0,a.jsx)("option",{value:"FIXED",children:"$"})]}),(0,a.jsx)("input",{type:"number",step:"0.01",min:"0",value:z,onChange:e=>U(parseFloat(e.target.value)||0),className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500",placeholder:"0"})]})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-2 border-t border-gray-200 pt-4",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal:"}),(0,a.jsx)("span",{className:"font-medium",children:N(eF()??0)})]}),z>0&&(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Discount:"}),(0,a.jsxs)("span",{className:"font-medium text-red-600",children:["-",N(eT()??0)]})]}),(0,a.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,a.jsx)("span",{children:"Total:"}),(0,a.jsx)("span",{className:"text-emerald-600",children:N(eI()??0)})]})]}),(0,a.jsx)("button",{onClick:()=>V(!0),disabled:P?.length===0,className:"mt-4 w-full rounded-lg bg-emerald-600 py-3 font-semibold text-white hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-50",children:"Checkout"})]})]})]})]})})]}),W&&!X&&(0,a.jsx)(R,{total:eI(),subtotal:eF(),discount:eT(),cartItems:P,customer:L,onClose:()=>V(!1),onPayment:eA}),X&&Q&&(0,a.jsx)(R,{total:Q.total,subtotal:Q.subtotal,discount:Q.discountAmount||0,cartItems:Q.items?.map(e=>({product:{name:e.product?.name||"Product",price:e.unitPrice},quantity:e.quantity,discount:e.discount||0,subtotal:e.subtotal}))||[],customer:Q.customer,saleCompleted:!0,saleData:Q,onClose:()=>{Y(!1),J(null)},onPayment:()=>{}}),eb&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-xl bg-white p-6 shadow-xl",children:[(0,a.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Keyboard Shortcuts"}),(0,a.jsx)("button",{onClick:()=>ey(!1),className:"rounded-full p-2 hover:bg-gray-100",children:(0,a.jsx)(d.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Focus Barcode Scanner"}),(0,a.jsx)("kbd",{className:"rounded bg-gray-200 px-2 py-1 text-xs font-semibold text-gray-700",children:"F1"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Open Payment (if cart not empty)"}),(0,a.jsx)("kbd",{className:"rounded bg-gray-200 px-2 py-1 text-xs font-semibold text-gray-700",children:"F2"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Clear Cart"}),(0,a.jsx)("kbd",{className:"rounded bg-gray-200 px-2 py-1 text-xs font-semibold text-gray-700",children:"F3"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Toggle Filters"}),(0,a.jsx)("kbd",{className:"rounded bg-gray-200 px-2 py-1 text-xs font-semibold text-gray-700",children:"F4"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Toggle Quick Templates"}),(0,a.jsx)("kbd",{className:"rounded bg-gray-200 px-2 py-1 text-xs font-semibold text-gray-700",children:"F5"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Close Modals"}),(0,a.jsx)("kbd",{className:"rounded bg-gray-200 px-2 py-1 text-xs font-semibold text-gray-700",children:"Esc"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg bg-gray-50 p-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-700",children:"Show This Help"}),(0,a.jsx)("kbd",{className:"rounded bg-gray-200 px-2 py-1 text-xs font-semibold text-gray-700",children:"Shift+?"})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{onClick:()=>ey(!1),className:"w-full rounded-lg bg-emerald-600 px-4 py-2 font-medium text-white hover:bg-emerald-700",children:"Got It!"})})]})})]})}},34669:function(e,t,s){"use strict";s.d(t,{N:function(){return r}});class a{async init(){return new Promise((e,t)=>{let s=indexedDB.open("pos_offline_db",1);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e()},s.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("transactions")){let e=t.createObjectStore("transactions",{keyPath:"id"});e.createIndex("synced","synced",{unique:!1}),e.createIndex("type","type",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}t.objectStoreNames.contains("products")||t.createObjectStore("products",{keyPath:"id"}),t.objectStoreNames.contains("customers")||t.createObjectStore("customers",{keyPath:"id"}),t.objectStoreNames.contains("categories")||t.createObjectStore("categories",{keyPath:"id"})}})}async addTransaction(e){return this.db||await this.init(),new Promise((t,s)=>{let a=this.db.transaction("transactions","readwrite").objectStore("transactions").add(e);a.onsuccess=()=>t(),a.onerror=()=>s(a.error)})}async getUnsyncedTransactions(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("transactions","readonly").objectStore("transactions").index("synced").getAll(IDBKeyRange.only(!1));s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async markTransactionSynced(e){return this.db||await this.init(),new Promise((t,s)=>{let a=this.db.transaction("transactions","readwrite").objectStore("transactions"),r=a.get(e);r.onsuccess=()=>{let e=r.result;if(e){e.synced=!0;let r=a.put(e);r.onsuccess=()=>t(),r.onerror=()=>s(r.error)}else t()},r.onerror=()=>s(r.error)})}async cacheProducts(e){return this.db||await this.init(),new Promise((t,s)=>{let a=this.db.transaction("products","readwrite"),r=a.objectStore("products");r.clear().onsuccess=()=>{e.forEach(e=>{r.add(e)})},a.oncomplete=()=>t(),a.onerror=()=>s(a.error)})}async getCachedProducts(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("products","readonly").objectStore("products").getAll();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async cacheCustomers(e){return this.db||await this.init(),new Promise((t,s)=>{let a=this.db.transaction("customers","readwrite"),r=a.objectStore("customers");r.clear().onsuccess=()=>{e.forEach(e=>{r.add(e)})},a.oncomplete=()=>t(),a.onerror=()=>s(a.error)})}async getCachedCustomers(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("customers","readonly").objectStore("customers").getAll();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}async cacheCategories(e){return this.db||await this.init(),new Promise((t,s)=>{let a=this.db.transaction("categories","readwrite"),r=a.objectStore("categories");r.clear().onsuccess=()=>{e.forEach(e=>{r.add(e)})},a.oncomplete=()=>t(),a.onerror=()=>s(a.error)})}async getCachedCategories(){return this.db||await this.init(),new Promise((e,t)=>{let s=this.db.transaction("categories","readonly").objectStore("categories").getAll();s.onsuccess=()=>e(s.result),s.onerror=()=>t(s.error)})}constructor(){this.db=null}}let r=new a}},function(e){e.O(0,[915,302,676,258,535,364,608,386,156,744],function(){return e(e.s=71426)}),_N_E=e.O()}]);