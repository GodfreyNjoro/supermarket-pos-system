(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[407],{21337:function(e,s,a){Promise.resolve().then(a.bind(a,12541))},12541:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return C}});var t=a(15444),r=a(89300),n=a(75762),l=a(3763),c=a(95777),i=a(46271),d=a(11117),o=a(2422),m=a(74678),h=a(34635),x=a(99827),u=a(91585),p=a(42154);let g=(0,p.Z)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),f=(0,p.Z)("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);var j=a(77248),y=a(33485);let N=(0,p.Z)("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),b=(0,p.Z)("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);var w=a(1946),v=a(81471);let k=(0,p.Z)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function C(){let{data:e}=(0,n.useSession)()||{},[s,a]=(0,r.useState)(!1),[p,C]=(0,r.useState)({host:"localhost",port:"5432",database:"supermarket_pos",username:"postgres",password:""}),[S,Z]=(0,r.useState)(!1),[A,F]=(0,r.useState)(!1),[D,_]=(0,r.useState)(null),[I,P]=(0,r.useState)(!1),[O,R]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=window.electronAPI;a(!!e),e&&z(),E()},[]);let z=async()=>{try{let e=await window.electronAPI.getDbConfig();e&&(C(e.config||p),P(e.useLocalDb||!1))}catch(e){console.error("Failed to load saved config:",e)}},E=async()=>{try{let e=Date.now(),s=await fetch("/api/settings/database/test-cloud"),a=Date.now()-e,t=await s.json();R({connected:t.connected,message:t.message,latency:a})}catch(e){R({connected:!1,message:"Cloud server unreachable"})}},L=async()=>{Z(!0),_(null);try{let e=Date.now(),s=await fetch("/api/settings/database/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),a=Date.now()-e,t=await s.json();_({connected:t.success,message:t.message,latency:a}),t.success?u.Am.success("Connection successful!"):u.Am.error(t.message)}catch(e){_({connected:!1,message:"Failed to test connection"}),u.Am.error("Failed to test connection")}finally{Z(!1)}},T=async()=>{if(!s){u.Am.error("Database settings can only be saved in desktop app");return}F(!0);try{if(await window.electronAPI.saveDbConfig({config:p,useLocalDb:I}),I&&D?.connected){let e=await fetch("/api/settings/database/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),s=await e.json();if(!s.success){u.Am.error("Failed to initialize database: "+s.message);return}}u.Am.success("Database configuration saved!")}catch(e){u.Am.error("Failed to save configuration")}finally{F(!1)}};return(0,t.jsx)(i.I,{children:(0,t.jsx)(d.p,{allowedRoles:["ADMIN"],children:(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,t.jsx)(l.W,{}),(0,t.jsx)(c.FE,{children:(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(g,{className:"h-8 w-8 text-primary"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Database Settings"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Configure your database connection"})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)(x.Zb,{className:`cursor-pointer transition-all ${I?"hover:border-primary/50":"ring-2 ring-primary"}`,onClick:()=>P(!1),children:[(0,t.jsxs)(x.Ol,{className:"pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f,{className:"h-5 w-5 text-blue-500"}),(0,t.jsx)(x.ll,{className:"text-lg",children:"Cloud Database"})]}),(0,t.jsx)(x.SZ,{children:"Connect to central cloud server for multi-location sync"})]}),(0,t.jsx)(x.aY,{children:(0,t.jsx)("div",{className:"flex items-center gap-2 text-sm",children:O?.connected?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 text-green-500"})," Connected (",O.latency,"ms)"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y.Z,{className:"h-4 w-4 text-red-500"})," ",O?.message||"Checking..."]})})})]}),(0,t.jsxs)(x.Zb,{className:`cursor-pointer transition-all ${I?"ring-2 ring-primary":"hover:border-primary/50"} ${s?"":"opacity-50"}`,onClick:()=>s&&P(!0),children:[(0,t.jsxs)(x.Ol,{className:"pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(N,{className:"h-5 w-5 text-orange-500"}),(0,t.jsx)(x.ll,{className:"text-lg",children:"Local Database"})]}),(0,t.jsx)(x.SZ,{children:s?"Connect to local PostgreSQL for offline operation":"Only available in desktop app"})]}),(0,t.jsx)(x.aY,{children:(0,t.jsx)("div",{className:"flex items-center gap-2 text-sm",children:D?.connected?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(j.Z,{className:"h-4 w-4 text-green-500"})," Connected (",D.latency,"ms)"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(b,{className:"h-4 w-4 text-gray-400"})," Not configured"]})})})]})]}),I&&s&&(0,t.jsxs)(x.Zb,{children:[(0,t.jsxs)(x.Ol,{children:[(0,t.jsx)(x.ll,{children:"Local PostgreSQL Configuration"}),(0,t.jsx)(x.SZ,{children:"Enter your local PostgreSQL server details"})]}),(0,t.jsxs)(x.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h._,{htmlFor:"host",children:"Host"}),(0,t.jsx)(m.I,{id:"host",value:p.host,onChange:e=>C({...p,host:e.target.value}),placeholder:"localhost"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h._,{htmlFor:"port",children:"Port"}),(0,t.jsx)(m.I,{id:"port",value:p.port,onChange:e=>C({...p,port:e.target.value}),placeholder:"5432"})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h._,{htmlFor:"database",children:"Database Name"}),(0,t.jsx)(m.I,{id:"database",value:p.database,onChange:e=>C({...p,database:e.target.value}),placeholder:"supermarket_pos"})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h._,{htmlFor:"username",children:"Username"}),(0,t.jsx)(m.I,{id:"username",value:p.username,onChange:e=>C({...p,username:e.target.value}),placeholder:"postgres"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(h._,{htmlFor:"password",children:"Password"}),(0,t.jsx)(m.I,{id:"password",type:"password",value:p.password,onChange:e=>C({...p,password:e.target.value}),placeholder:"••••••••"})]})]}),(0,t.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,t.jsx)(o.z,{onClick:L,disabled:S,variant:"outline",children:S?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Z,{className:"h-4 w-4 mr-2 animate-spin"})," Testing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.Z,{className:"h-4 w-4 mr-2"})," Test Connection"]})}),(0,t.jsx)(o.z,{onClick:T,disabled:A||!D?.connected,children:A?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Z,{className:"h-4 w-4 mr-2 animate-spin"})," Saving..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(k,{className:"h-4 w-4 mr-2"})," Save Configuration"]})})]}),D&&(0,t.jsx)("div",{className:`p-3 rounded-lg ${D.connected?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[D.connected?(0,t.jsx)(j.Z,{className:"h-4 w-4"}):(0,t.jsx)(y.Z,{className:"h-4 w-4"}),D.message]})})]})]}),I&&s&&(0,t.jsxs)(x.Zb,{children:[(0,t.jsxs)(x.Ol,{children:[(0,t.jsxs)(x.ll,{className:"flex items-center gap-2",children:[(0,t.jsx)(f,{className:"h-5 w-5"}),"Cloud Sync"]}),(0,t.jsx)(x.SZ,{children:"Synchronize local data with the central cloud server"})]}),(0,t.jsxs)(x.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Sync Status"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:O?.connected?"Cloud connected":"Cloud offline"})]}),(0,t.jsxs)(o.z,{variant:"outline",onClick:async()=>{u.Am.info("Sync started...");try{await window.electronAPI.triggerSync(),u.Am.success("Sync completed!")}catch{u.Am.error("Sync failed")}},disabled:!O?.connected,children:[(0,t.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Sync Now"]})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"When online, local changes will automatically sync to the cloud server. Changes from other locations will be pulled down to your local database."})]})]}),(0,t.jsxs)(x.Zb,{children:[(0,t.jsx)(x.Ol,{children:(0,t.jsx)(x.ll,{children:"Setup Instructions"})}),(0,t.jsxs)(x.aY,{className:"prose dark:prose-invert max-w-none",children:[(0,t.jsx)("h4",{children:"Installing PostgreSQL Locally"}),(0,t.jsxs)("ol",{className:"text-sm space-y-2",children:[(0,t.jsxs)("li",{children:["Download PostgreSQL from ",(0,t.jsx)("a",{href:"https://www.postgresql.org/download/",target:"_blank",rel:"noopener",className:"text-primary hover:underline",children:"postgresql.org"})]}),(0,t.jsx)("li",{children:"Run the installer and set a password for the postgres user"}),(0,t.jsxs)("li",{children:["Create a new database named ",(0,t.jsx)("code",{className:"bg-muted px-1 rounded",children:"supermarket_pos"})]}),(0,t.jsx)("li",{children:"Enter your connection details above and test the connection"}),(0,t.jsx)("li",{children:"Click Save to apply the configuration"})]}),(0,t.jsx)("h4",{className:"mt-4",children:"Quick Database Creation (Terminal)"}),(0,t.jsx)("pre",{className:"bg-muted p-3 rounded text-xs overflow-x-auto",children:`psql -U postgres
CREATE DATABASE supermarket_pos;
\\q`})]})]})]})})]})})})}},11117:function(e,s,a){"use strict";a.d(s,{p:function(){return c}});var t=a(15444),r=a(75762),n=a(79047),l=a(89300);function c({children:e,allowedRoles:s,fallbackUrl:a="/dashboard"}){let{data:c,status:i}=(0,r.useSession)()||{},d=(0,n.useRouter)();if((0,l.useEffect)(()=>{if("authenticated"===i&&c?.user){let e=c.user?.role;s?.includes?.(e)||d.replace(a)}},[i,c,s,a,d]),"loading"===i)return(0,t.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,t.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-gray-300 border-t-emerald-600"})});if("authenticated"===i){let a=c?.user?.role;if(s?.includes?.(a))return(0,t.jsx)(t.Fragment,{children:e})}return null}},99827:function(e,s,a){"use strict";a.d(s,{Ol:function(){return c},SZ:function(){return d},Zb:function(){return l},aY:function(){return o},ll:function(){return i}});var t=a(15444),r=a(89300),n=a(65522);let l=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));l.displayName="Card";let c=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...s}));c.displayName="CardHeader";let i=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)("h3",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));i.displayName="CardTitle";let d=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)("p",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",e),...s}));d.displayName="CardDescription";let o=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",e),...s}));o.displayName="CardContent",r.forwardRef(({className:e,...s},a)=>(0,t.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter"},74678:function(e,s,a){"use strict";a.d(s,{I:function(){return l}});var t=a(15444),r=a(89300),n=a(65522);let l=r.forwardRef(({className:e,type:s,...a},r)=>(0,t.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));l.displayName="Input"},34635:function(e,s,a){"use strict";a.d(s,{_:function(){return d}});var t=a(15444),r=a(89300),n=a(4100),l=a(2371),c=a(65522);let i=(0,l.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef(({className:e,...s},a)=>(0,t.jsx)(n.f,{ref:a,className:(0,c.cn)(i(),e),...s}));d.displayName=n.f.displayName},1946:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(42154).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[676,258,535,652,608,386,156,744],function(){return e(e.s=21337)}),_N_E=e.O()}]);