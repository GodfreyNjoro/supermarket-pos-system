generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
    output = "/home/ubuntu/supermarket_pos_system/nextjs_space/node_modules/.prisma/client"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CASHIER
}

enum PaymentMethod {
  CASH
  CARD
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  role      Role     @default(CASHIER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  sales     Sale[]
}

model Category {
  id        String    @id @default(cuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  products  Product[]
}

model Product {
  id                String      @id @default(cuid())
  barcode           String      @unique
  name              String
  description       String?
  price             Float
  stock             Int         @default(0)
  reorderLevel      Int         @default(10)
  categoryId        String
  category          Category    @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  imageUrl          String?
  cloud_storage_path String?
  isPublic          Boolean     @default(true)
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  saleItems         SaleItem[]
  returnItems       ReturnItem[]
  
  @@index([categoryId])
  @@index([barcode])
}

model Customer {
  id            String   @id @default(cuid())
  name          String
  phone         String?  @unique
  email         String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  sales         Sale[]
  
  @@index([phone])
  @@index([email])
}

model Sale {
  id              String        @id @default(cuid())
  receiptNumber   String        @unique
  userId          String
  user            User          @relation(fields: [userId], references: [id])
  customerId      String?
  customer        Customer?     @relation(fields: [customerId], references: [id], onDelete: SetNull)
  subtotal        Float
  discountType    String?       // "PERCENTAGE" or "FIXED"
  discountValue   Float         @default(0)
  discountAmount  Float         @default(0)
  total           Float
  paymentMethod   PaymentMethod
  amountPaid      Float
  changeGiven     Float         @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  items           SaleItem[]
  returns         Return[]
  
  @@index([userId])
  @@index([customerId])
  @@index([receiptNumber])
  @@index([createdAt])
}

model SaleItem {
  id          String   @id @default(cuid())
  saleId      String
  sale        Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  quantity    Int
  unitPrice   Float
  discount    Float    @default(0)
  subtotal    Float
  createdAt   DateTime @default(now())
  
  @@index([saleId])
  @@index([productId])
}

model Return {
  id              String       @id @default(cuid())
  returnNumber    String       @unique
  saleId          String
  sale            Sale         @relation(fields: [saleId], references: [id])
  reason          String
  totalRefund     Float
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  items           ReturnItem[]
  
  @@index([saleId])
  @@index([returnNumber])
}

model ReturnItem {
  id          String   @id @default(cuid())
  returnId    String
  return      Return   @relation(fields: [returnId], references: [id], onDelete: Cascade)
  productId   String
  product     Product  @relation(fields: [productId], references: [id])
  quantity    Int
  refundAmount Float
  createdAt   DateTime @default(now())
  
  @@index([returnId])
  @@index([productId])
}
